# Scalar types (for codegen - also defined in create-schema.ts)
scalar JSONObject
scalar DateTime

# Input types
input PagingInput {
  limit: Int
  offset: Int
  cursor: String
}

input ViewFilterInput {
  branch: String
  scopes: [String!]
}

input SearchFilterInput {
  type: String
  parentId: String
  identifiers: [String!]
}

# Enums
enum PropagationMode {
  CASCADE
  ORPHAN
}

enum DocumentChangeType {
  CREATED
  DELETED
  UPDATED
  PARENT_ADDED
  PARENT_REMOVED
  CHILD_ADDED
  CHILD_REMOVED
}

# Object types
type DocumentModelGlobalState {
  id: String!
  name: String!
  namespace: String
  version: String
  specification: JSONObject!
}

type DocumentModelResultPage {
  items: [DocumentModelGlobalState!]!
  totalCount: Int!
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  cursor: String
}

type Revision {
  scope: String!
  revision: Int!
}

type PHDocument {
  id: String!
  slug: String
  name: String!
  documentType: String!
  state: JSONObject!
  revisionsList: [Revision!]!
  createdAtUtcIso: DateTime!
  lastModifiedAtUtcIso: DateTime!
  parentId: String
}

type PHDocumentResultPage {
  items: [PHDocument!]!
  totalCount: Int!
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  cursor: String
}

type DocumentWithChildren {
  document: PHDocument!
  childIds: [String!]!
}

type MoveChildrenResult {
  source: PHDocument!
  target: PHDocument!
}

type JobInfo {
  id: String!
  status: String!
  result: JSONObject!
  error: String
  createdAt: DateTime!
  completedAt: DateTime
}

type DocumentChangeEvent {
  type: DocumentChangeType!
  documents: [PHDocument!]!
  context: DocumentChangeContext
}

type DocumentChangeContext {
  parentId: String
  childId: String
}

type JobChangeEvent {
  jobId: String!
  status: String!
  result: JSONObject!
  error: String
}

type ReactorSignerUser {
  address: String!
  networkId: String!
  chainId: Int!
}

type ReactorSignerApp {
  name: String!
  key: String!
}

type ReactorSigner {
  user: ReactorSignerUser
  app: ReactorSignerApp
  signatures: [String!]!
}

type ActionContext {
  signer: ReactorSigner
}

type Action {
  id: String!
  type: String!
  timestampUtcMs: String!
  input: JSONObject!
  scope: String!
  attachments: [Attachment!]
  context: ActionContext
}

type Attachment {
  data: String!
  mimeType: String!
  hash: String!
  extension: String
  fileName: String
}

# Input types for sync operations
input ActionContextInput {
  signer: ReactorSignerInput
}

input ReactorSignerInput {
  user: ReactorSignerUserInput
  app: ReactorSignerAppInput
  signatures: [String!]!
}

input ReactorSignerUserInput {
  address: String!
  networkId: String!
  chainId: Int!
}

input ReactorSignerAppInput {
  name: String!
  key: String!
}

input ActionInput {
  id: String!
  type: String!
  timestampUtcMs: String!
  input: JSONObject!
  scope: String!
  attachments: [AttachmentInput!]
  context: ActionContextInput
}

input AttachmentInput {
  data: String!
  mimeType: String!
  hash: String!
  extension: String
  fileName: String
}

# Synchronization types
type ReactorOperation {
  index: Int!
  timestampUtcMs: String!
  hash: String!
  skip: Int!
  error: String
  id: String
  action: Action!
}

input OperationInput {
  index: Int!
  timestampUtcMs: String!
  hash: String!
  skip: Int!
  error: String
  id: String
  action: ActionInput!
}

type OperationContext {
  documentId: String!
  documentType: String!
  scope: String!
  branch: String!
}

input OperationContextInput {
  documentId: String!
  documentType: String!
  scope: String!
  branch: String!
}

type OperationWithContext {
  operation: ReactorOperation!
  context: OperationContext!
}

input OperationWithContextInput {
  operation: OperationInput!
  context: OperationContextInput!
}

type ChannelMeta {
  id: String!
}

input ChannelMetaInput {
  id: String!
}

type RemoteCursor {
  remoteName: String!
  cursorOrdinal: Int!
  lastSyncedAtUtcMs: String
}

input RemoteCursorInput {
  remoteName: String!
  cursorOrdinal: Int!
  lastSyncedAtUtcMs: String
}

enum SyncEnvelopeType {
  OPERATIONS
  ACK
}

type SyncEnvelope {
  type: SyncEnvelopeType!
  channelMeta: ChannelMeta!
  operations: [OperationWithContext!]
  cursor: RemoteCursor
}

input SyncEnvelopeInput {
  type: SyncEnvelopeType!
  channelMeta: ChannelMetaInput!
  operations: [OperationWithContextInput!]
  cursor: RemoteCursorInput
}

input RemoteFilterInput {
  documentId: [String!]!
  scope: [String!]!
  branch: String!
}

input TouchChannelInput {
  id: String!
  name: String!
  collectionId: String!
  filter: RemoteFilterInput!
}

type Query {
  # Get document models for a namespace
  documentModels(
    namespace: String
    paging: PagingInput
  ): DocumentModelResultPage!

  # Get a specific document by ID or slug
  document(
    identifier: String!
    view: ViewFilterInput
  ): DocumentWithChildren

  # Get children of a document
  documentChildren(
    parentIdentifier: String!
    view: ViewFilterInput
    paging: PagingInput
  ): PHDocumentResultPage!

  # Get parents of a document
  documentParents(
    childIdentifier: String!
    view: ViewFilterInput
    paging: PagingInput
  ): PHDocumentResultPage!

  # Find documents by search criteria
  findDocuments(
    search: SearchFilterInput!
    view: ViewFilterInput
    paging: PagingInput
  ): PHDocumentResultPage!

  # Get job status
  jobStatus(jobId: String!): JobInfo

  # Poll for sync envelopes from a channel
  pollSyncEnvelopes(
    channelId: String!
    cursorOrdinal: Int!
  ): [SyncEnvelope!]!
}

type Mutation {
  # Create a new document
  createDocument(
    document: JSONObject!
    parentIdentifier: String
  ): PHDocument!

  # Create an empty document of specified type
  createEmptyDocument(
    documentType: String!
    parentIdentifier: String
  ): PHDocument!

  # Apply actions to a document (synchronous)
  mutateDocument(
    documentIdentifier: String!
    actions: [JSONObject!]!
    view: ViewFilterInput
  ): PHDocument!

  # Submit actions to a document (asynchronous)
  mutateDocumentAsync(
    documentIdentifier: String!
    actions: [JSONObject!]!
    view: ViewFilterInput
  ): String!

  # Rename a document
  renameDocument(
    documentIdentifier: String!
    name: String!
    branch: String
  ): PHDocument!

  # Add children to a document
  addChildren(
    parentIdentifier: String!
    documentIdentifiers: [String!]!
    branch: String
  ): PHDocument!

  # Remove children from a document
  removeChildren(
    parentIdentifier: String!
    documentIdentifiers: [String!]!
    branch: String
  ): PHDocument!

  # Move children between documents
  moveChildren(
    sourceParentIdentifier: String!
    targetParentIdentifier: String!
    documentIdentifiers: [String!]!
    branch: String
  ): MoveChildrenResult!

  # Delete a single document
  deleteDocument(
    identifier: String!
    propagate: PropagationMode
  ): Boolean!

  # Delete multiple documents
  deleteDocuments(
    identifiers: [String!]!
    propagate: PropagationMode
  ): Boolean!

  # Touch (create or update) a channel for sync
  touchChannel(
    input: TouchChannelInput!
  ): Boolean!

  # Push sync envelope to a channel
  pushSyncEnvelope(
    envelope: SyncEnvelopeInput!
  ): Boolean!
}

type Subscription {
  # Subscribe to document changes
  documentChanges(
    search: SearchFilterInput!
    view: ViewFilterInput
  ): DocumentChangeEvent!

  # Subscribe to job changes
  jobChanges(
    jobId: String!
  ): JobChangeEvent!
}

