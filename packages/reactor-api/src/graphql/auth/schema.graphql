# Auth Subgraph Schema
# Contains all document permission and authorization related types

scalar DateTime

# Permission levels for documents
enum DocumentPermissionLevel {
  # Can fetch and read the document
  READ
  # Can push updates and modify the document
  WRITE
  # Can manage document permissions and settings
  ADMIN
}

# Document permission entry
type DocumentPermissionEntry {
  documentId: String!
  userAddress: String!
  permission: DocumentPermissionLevel!
  grantedBy: String!
  createdAt: DateTime!
  updatedAt: DateTime!
}

# Group type
type Group {
  id: Int!
  name: String!
  description: String
  createdAt: DateTime!
  updatedAt: DateTime!
  members: [String!]!
}

# Document group permission entry
type DocumentGroupPermission {
  documentId: String!
  groupId: Int!
  group: Group!
  permission: DocumentPermissionLevel!
  grantedBy: String!
  createdAt: DateTime!
  updatedAt: DateTime!
}

# Operation user permission entry
type OperationUserPermission {
  documentId: String!
  operationType: String!
  userAddress: String!
  grantedBy: String!
  createdAt: DateTime!
}

# Operation group permission entry
type OperationGroupPermission {
  documentId: String!
  operationType: String!
  groupId: Int!
  group: Group!
  grantedBy: String!
  createdAt: DateTime!
}

# Combined document access info
type DocumentAccessInfo {
  documentId: String!
  permissions: [DocumentPermissionEntry!]!
  groupPermissions: [DocumentGroupPermission!]!
}

# Operation permissions info
type OperationPermissionsInfo {
  documentId: String!
  operationType: String!
  userPermissions: [OperationUserPermission!]!
  groupPermissions: [OperationGroupPermission!]!
}

type Query {
  # Get permissions for a document
  documentAccess(documentId: String!): DocumentAccessInfo!

  # Get all documents the current user has explicit access to
  userDocumentPermissions: [DocumentPermissionEntry!]!

  # Get all groups
  groups: [Group!]!

  # Get a specific group by ID
  group(id: Int!): Group

  # Get all groups a user belongs to
  userGroups(userAddress: String!): [Group!]!

  # Get operation permissions for a document and operation type
  operationPermissions(documentId: String!, operationType: String!): OperationPermissionsInfo!

  # Check if the current user can execute a specific operation on a document
  canExecuteOperation(documentId: String!, operationType: String!): Boolean!
}

type Mutation {
  # Grant a user permission on a document (requires ADMIN permission or global admin)
  grantDocumentPermission(
    documentId: String!
    userAddress: String!
    permission: DocumentPermissionLevel!
  ): DocumentPermissionEntry!

  # Revoke a user's permission on a document (requires ADMIN permission or global admin)
  revokeDocumentPermission(
    documentId: String!
    userAddress: String!
  ): Boolean!

  # --- Group Management ---

  # Create a new group
  createGroup(name: String!, description: String): Group!

  # Delete a group and all its associations
  deleteGroup(id: Int!): Boolean!

  # Add a user to a group
  addUserToGroup(userAddress: String!, groupId: Int!): Boolean!

  # Remove a user from a group
  removeUserFromGroup(userAddress: String!, groupId: Int!): Boolean!

  # --- Group Document Permissions ---

  # Grant a group permission on a document
  grantGroupPermission(
    documentId: String!
    groupId: Int!
    permission: DocumentPermissionLevel!
  ): DocumentGroupPermission!

  # Revoke a group's permission on a document
  revokeGroupPermission(documentId: String!, groupId: Int!): Boolean!

  # --- Operation Permissions ---

  # Grant a user permission to execute an operation on a document
  grantOperationPermission(
    documentId: String!
    operationType: String!
    userAddress: String!
  ): OperationUserPermission!

  # Revoke a user's permission to execute an operation
  revokeOperationPermission(
    documentId: String!
    operationType: String!
    userAddress: String!
  ): Boolean!

  # Grant a group permission to execute an operation on a document
  grantGroupOperationPermission(
    documentId: String!
    operationType: String!
    groupId: Int!
  ): OperationGroupPermission!

  # Revoke a group's permission to execute an operation
  revokeGroupOperationPermission(
    documentId: String!
    operationType: String!
    groupId: Int!
  ): Boolean!
}
