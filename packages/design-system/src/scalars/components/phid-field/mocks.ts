import type { IdAutocompleteOption } from "@/scalars/components/fragments/id-autocomplete-field/types";

export const mockedOptions: IdAutocompleteOption[] = [
  {
    icon: "PowerhouseLogoSmall",
    title: "Document A",
    path: {
      text: "projects/finance/document-a",
    },
    value: "phd:baefc2a4-f9a0-4950-8161-fd8d8cc7dea7:main:public",
    description: "Financial report for Q1 2024",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "Document B",
    path: {
      text: "projects/legal/document-b",
    },
    value: "phd:baefc2a4-f9a0-4950-8161-fd8d8cc6cdb8:main:public",
    description: "Legal compliance documentation",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "Document C",
    path: {
      text: "projects/operations/document-c",
    },
    value: "phd:baefc2a4-f9a0-4950-8161-fd8d8cc5efc9:main:public",
    description: "Operational guidelines and procedures",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "Marketing Strategy Plan",
    path: {
      text: "projects/marketing/strategy-2024",
    },
    value: "phd:baefc2a4-f9a0-4950-8161-fd8d8cc1cfe3:main:public",
    description:
      "Comprehensive marketing initiatives and campaign planning for 2024",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "System Architecture Overview",
    path: {
      text: "projects/tech/system-architecture",
    },
    value: "phd:baefc2a4-f9a0-4950-8161-fd8d8cc0bfe4:main:public",
    description:
      "Technical documentation of system components and infrastructure",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "Sales Performance Report Q1",
    path: {
      text: "projects/sales/q1-2024-performance",
    },
    value: "phd:baefc2a4-f9a0-4950-8161-fd8d8cbfafe5:main:public",
    description: "Analysis of Q1 2024 sales metrics and team performance",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "Information Security Policy",
    path: {
      text: "projects/security/security-policy",
    },
    value: "phd:baefc2a4-f9a0-4950-8161-fd8d8cbe9fe6:main:public",
    description: "Corporate security guidelines and compliance requirements",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "2024 Budget Forecast",
    path: {
      text: "projects/finance/budget-2024",
    },
    value: "phd:baefc2a4-f9a0-4950-8161-fd8d8cbd8fe7:main:public",
    description: "Annual budget projections and financial planning for 2024",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "Onboarding Process Guide",
    path: {
      text: "projects/hr/onboarding-guide",
    },
    value: "phd:baefc2a4-f9a0-4950-8161-fd8d8cbc7fe8:main:public",
    description: "Step-by-step guide for new employee onboarding procedures",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "Operations Manual v2.0",
    path: {
      text: "projects/operations/manual-v2",
    },
    value: "phd:baefc2a4-f9a0-4950-8161-fd8d8cbb6fe9:main:public",
    description: "Updated standard operating procedures and guidelines",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "Brand Guidelines 2024",
    path: {
      text: "projects/marketing/brand-guidelines",
    },
    value: "phd:baefc2a4-f9a0-4950-8161-fd8d8cba5fea:main:public",
    description: "Official brand identity and usage guidelines",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "Legal Compliance Report",
    path: {
      text: "projects/legal/compliance-2024",
    },
    value: "phd:baefc2a4-f9a0-4950-8161-fd8d8cb94feb:main:public",
    description: "Annual legal compliance assessment and recommendations",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "Benefits Package 2024",
    path: {
      text: "projects/hr/benefits-2024",
    },
    value: "phd:baefc2a4-f9a0-4950-8161-fd8d8cb50fef:main:public",
    description: "Detailed overview of employee benefits and compensation",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "Risk Assessment Report",
    path: {
      text: "projects/security/risk-assessment",
    },
    value: "phd://security.powerhouse.io/baefc2a4-f9a0-4950-8161-fd8d8cb4fff0",
    description:
      "Comprehensive security risk analysis and mitigation strategies",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "Inventory Management Plan",
    path: {
      text: "projects/operations/inventory-2024",
    },
    value: "phd://ops.powerhouse.io/baefc2a4-f9a0-4950-8161-fd8d8cb3eff1",
    description: "Strategic plan for inventory control and optimization",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "Digital Marketing Report",
    path: {
      text: "projects/marketing/digital-report",
    },
    value: "phd://marketing.powerhouse.io/baefc2a4-f9a0-4950-8161-fd8d8cb2dff2",
    description: "Analysis of digital marketing campaigns and ROI",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "Market Research Analysis",
    path: {
      text: "projects/research/market-analysis",
    },
    value: "phd://research.powerhouse.io/baefc2a4-f9a0-4950-8161-fd8d8cb1cff3",
    description: "Comprehensive market trends and competitor analysis",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "User Experience Report",
    path: {
      text: "projects/product/ux-research",
    },
    value: "phd://product.powerhouse.io/baefc2a4-f9a0-4950-8161-fd8d8cb0bff4",
    description: "Findings from user experience research and testing",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "Social Media Strategy",
    path: {
      text: "projects/marketing/social-2024",
    },
    value: "phd://social.powerhouse.io/baefc2a4-f9a0-4950-8161-fd8d8caafff5",
    description: "Strategic plan for social media engagement and growth",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "Infrastructure Upgrade Plan",
    path: {
      text: "projects/tech/infrastructure-2024",
    },
    value: "phd://infra.powerhouse.io/baefc2a4-f9a0-4950-8161-fd8d8ca9eff6",
    description: "Technical roadmap for infrastructure improvements",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "Sustainability Report 2024",
    path: {
      text: "projects/operations/sustainability",
    },
    value:
      "phd://sustainability.powerhouse.io/baefc2a4-f9a0-4950-8161-fd8d8ca8eff7",
    description: "Annual environmental impact and sustainability initiatives",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "Cloud Architecture Design",
    path: {
      text: "projects/tech/cloud-architecture",
    },
    value: "phd://cloud.powerhouse.io/baefc2a4-f9a0-4950-8161-fd8d8ca7eff8",
    description: "Cloud infrastructure architecture and design specifications",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "Data Analytics Dashboard",
    path: {
      text: "projects/analytics/dashboard",
    },
    value: "phd://analytics.powerhouse.io/baefc2a4-f9a0-4950-8161-fd8d8ca6eff9",
    description: "Business intelligence and data analytics platform",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "DevOps Pipeline Documentation",
    path: {
      text: "projects/tech/devops-pipeline",
    },
    value: "phd://devops.powerhouse.io/baefc2a4-f9a0-4950-8161-fd8d8ca5effa",
    description: "CI/CD pipeline and deployment procedures",
  },
  {
    icon: "PowerhouseLogoSmall",
    title: "API Gateway Specification",
    path: {
      text: "projects/tech/api-gateway",
    },
    value: "phd://api.powerhouse.io/baefc2a4-f9a0-4950-8161-fd8d8ca4effb",
    description: "API gateway configuration and routing documentation",
  },
];

const filterOptions = (
  options: IdAutocompleteOption[],
  userInput: string,
  context?: Record<string, unknown>,
) => {
  const normalizedInput = userInput.toLowerCase();
  const allowUris = context?.allowUris as boolean;
  const allowedScopes = Array.isArray(context?.allowedScopes)
    ? context.allowedScopes
    : [];

  return options.filter((opt) => {
    const isUrl = opt.value.startsWith("phd://");

    if (!isUrl && !allowUris) {
      return false;
    }

    if (!isUrl && allowedScopes.length > 0) {
      const scope = opt.value.split(":").pop();
      if (scope && !allowedScopes.includes(scope)) {
        return false;
      }
    }

    return (
      opt.title?.toLowerCase().includes(normalizedInput) ||
      opt.path?.text.toLowerCase().includes(normalizedInput) ||
      opt.value.toLowerCase().includes(normalizedInput) ||
      opt.description?.toLowerCase().includes(normalizedInput)
    );
  });
};

// Async versions
export const fetchOptions = async (
  userInput: string,
  context?: Record<string, unknown>,
): Promise<IdAutocompleteOption[]> => {
  // Simulate 2s network delay
  await new Promise((resolve) => setTimeout(resolve, 2000));

  // Add 20% chance of error
  if (Math.random() < 0.2) {
    throw new Error();
  }

  return filterOptions(mockedOptions, userInput, context);
};

export const fetchSelectedOption = async (
  value: string,
): Promise<IdAutocompleteOption | undefined> => {
  // Simulate 2s network delay
  await new Promise((resolve) => setTimeout(resolve, 2000));
  return mockedOptions.find((option) => option.value === value);
};

// Sync versions
export const fetchOptionsSync = (
  userInput: string,
  context?: Record<string, unknown>,
): IdAutocompleteOption[] => {
  return filterOptions(mockedOptions, userInput, context);
};

export const fetchSelectedOptionSync = (
  value: string,
): IdAutocompleteOption | undefined => {
  return mockedOptions.find((option) => option.value === value);
};
