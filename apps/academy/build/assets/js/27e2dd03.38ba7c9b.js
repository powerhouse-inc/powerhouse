"use strict";(self.webpackChunk_powerhousedao_academy=self.webpackChunk_powerhousedao_academy||[]).push([[4528],{826:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/SwitchboardButton-5b9ff87cc7d965b49debc7f1f0827cde.png"},888:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/OperationsQuery-2d0e218534bc9c638c05746b4b10d52d.png"},5145:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/OnboardingTasks-3537c6c05434b2271c83c07132a7d47b.png"},6034:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/AddNewDriveURL-c5e54171bfbad6ab3892d241aa3753b6.png"},7474:(e,t,o)=>{o.d(t,{R:()=>a,x:()=>s});var n=o(2155);const i={},r=n.createContext(i);function a(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),n.createElement(r.Provider,{value:t},e.children)}},7606:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/QueryDocumentID-659335a6ad8d1ab2559f00d5c7f3824e.png"},7633:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>l,frontMatter:()=>a,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"academy/MasteryTrack/WorkWithData/UsingTheAPI","title":"Using the API","description":"Introduction to Switchboard","source":"@site/docs/academy/02-MasteryTrack/04-WorkWithData/02-UsingTheAPI.mdx","sourceDirName":"academy/02-MasteryTrack/04-WorkWithData","slug":"/academy/MasteryTrack/WorkWithData/UsingTheAPI","permalink":"/academy/MasteryTrack/WorkWithData/UsingTheAPI","draft":false,"unlisted":false,"editUrl":"https://github.com/powerhouse-inc/powerhouse-docs/tree/dev/docs/academy/02-MasteryTrack/04-WorkWithData/02-UsingTheAPI.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{},"sidebar":"academySidebar","previous":{"title":"GraphQL at Powerhouse","permalink":"/academy/MasteryTrack/WorkWithData/GraphQLAtPowerhouse"},"next":{"title":"Using subgraphs","permalink":"/academy/MasteryTrack/WorkWithData/UsingSubgraphs"}}');var i=o(5723),r=o(7474);const a={},s="Using the API",d={},c=[{value:"Introduction to Switchboard",id:"introduction-to-switchboard",level:2},{value:"Querying a document with the GraphQL API",id:"querying-a-document-with-the-graphql-api",level:2},{value:"Starting the reactor locally",id:"starting-the-reactor-locally",level:3},{value:"Adding a remote drive or Reactor to Connect",id:"adding-a-remote-drive-or-reactor-to-connect",level:3},{value:"Query the state of a document",id:"query-the-state-of-a-document",level:2},{value:"Option 1: Query your document via the Switchboard API Button.",id:"option-1-query-your-document-via-the-switchboard-api-button",level:3},{value:"Option 2: Query your document by document ID",id:"option-2-query-your-document-by-document-id",level:3},{value:"Option 3: Search for your document ID via GraphQL",id:"option-3-search-for-your-document-id-via-graphql",level:3},{value:"Get the state of the document",id:"get-the-state-of-the-document",level:3},{value:"Mutate the state of a document",id:"mutate-the-state-of-a-document",level:2},{value:"Adding a new to-do item",id:"adding-a-new-to-do-item",level:3},{value:"Deleting a to-do item",id:"deleting-a-to-do-item",level:3},{value:"Verifying the changes",id:"verifying-the-changes",level:3},{value:"Summary",id:"summary",level:3}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"using-the-api",children:"Using the API"})}),"\n",(0,i.jsx)(t.h2,{id:"introduction-to-switchboard",children:"Introduction to Switchboard"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Switchboard"})," is the API interface that enables developers and data engineers to access data captured through document models in Connect and Fusion."]}),"\n",(0,i.jsx)(t.p,{children:"Once you've structured and captured data from your business processes, Switchboard allows you to leverage that data to build insightful experiences in external websites, create interactive drive widgets, or generate detailed reports and dashboards in Fusion."}),"\n",(0,i.jsx)(t.admonition,{title:"Using your document's state schema",type:"tip",children:(0,i.jsx)(t.p,{children:"Since your document models are defined with a GraphQL schema, you can use the same objects and fields in your queries and mutations to retrieve or write data from and to your documents."})}),"\n",(0,i.jsx)(t.h2,{id:"querying-a-document-with-the-graphql-api",children:"Querying a document with the GraphQL API"}),"\n",(0,i.jsx)(t.h3,{id:"starting-the-reactor-locally",children:"Starting the reactor locally"}),"\n",(0,i.jsxs)(t.p,{children:["In this tutorial, we'll show how to use a ",(0,i.jsx)(t.strong,{children:"GraphQL"})," query to query a document model. We'll continue with the ",(0,i.jsx)(t.strong,{children:"To-do List example"})," from our ",(0,i.jsx)(t.a,{href:"/academy/GetStarted/CreateNewPowerhouseProject",children:"introduction tutorial"}),", but the process can be applied to any other document model.\nTo make our document model available in the Apollo Studio Sandbox, we'll need to store it on a remote ",(0,i.jsx)(t.a,{href:"/academy/Architecture/WorkingWithTheReactor",children:"Reactor"}),"."]}),"\n",(0,i.jsx)(t.admonition,{title:"What are reactors?",type:"info",children:(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Powerhouse Reactors"})," are the nodes in the network that store documents, resolve conflicts, and rerun operations to verify document event histories.\nReactors can be configured for local storage, centralized cloud storage, or a decentralized storage network."]})}),"\n",(0,i.jsx)(t.p,{children:"Just as you can run Connect locally in studio mode, you can also run a Reactor locally. Use the following command in the terminal from within your Powerhouse project directory:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"ph reactor\n"})}),"\n",(0,i.jsx)(t.p,{children:"To start both Connect and a Reactor locally at the same time in a Powerhouse project, you can use the following command:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"ph dev\n"})}),"\n",(0,i.jsx)(t.p,{children:"This will return a URL to access the Reactor."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"[Reactor]:   \u279c  Reactor:   http://localhost:4001/d/powerhouse\n"})}),"\n",(0,i.jsx)(t.h3,{id:"adding-a-remote-drive-or-reactor-to-connect",children:"Adding a remote drive or Reactor to Connect"}),"\n",(0,i.jsxs)(t.p,{children:["If the remote drive or Reactor isn't present yet in Connect, you can add it by clicking the (+) 'Create New Drive' button in the Connect drive navigation and using the localhost URL to add a new drive with its underlying reactor. Usually, this is ",(0,i.jsx)(t.a,{href:"http://localhost:4001/d/powerhouse",children:"http://localhost:4001/d/powerhouse"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["Get access to an ",(0,i.jsx)(t.strong,{children:"organization's drive"})," instances by adding their drive to your Connect Drive navigation tree view with the help of the correct drive URL.\nClick the (+) 'Create New Drive' to add a public drive. To add a new drive, you'll have to know the correct public URL of the drive. Read more about ",(0,i.jsx)(t.a,{href:"/academy/Architecture/WorkingWithTheReactor",children:"configuring drives"}),"."]}),"\n",(0,i.jsxs)("figure",{className:"image-container",children:[(0,i.jsx)("img",{src:o(6034).A,alt:"Add a drive through an URL"}),(0,i.jsx)("figcaption",{children:(0,i.jsx)(t.p,{children:"The 'Add Drive' button that allows you to enter a Drive URL."})})]}),"\n",(0,i.jsx)(t.h2,{id:"query-the-state-of-a-document",children:"Query the state of a document"}),"\n",(0,i.jsxs)(t.p,{children:["Now that we have our remote reactor and/or drive running, we can store our document model on it.\nLet's quickly create a new to-do list document in Connect Studio to test the process. Let's call it ",(0,i.jsx)(t.strong,{children:"'Powerhouse-onboarding-tasks'"}),"."]}),"\n",(0,i.jsx)(t.p,{children:"Add the following to-dos to your list:"}),"\n",(0,i.jsxs)(t.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(t.li,{className:"task-list-item",children:[(0,i.jsx)(t.input,{type:"checkbox",disabled:!0})," ","Sign up for Powerhouse"]}),"\n",(0,i.jsxs)(t.li,{className:"task-list-item",children:[(0,i.jsx)(t.input,{type:"checkbox",disabled:!0})," ","Do the work"]}),"\n",(0,i.jsxs)(t.li,{className:"task-list-item",children:[(0,i.jsx)(t.input,{type:"checkbox",disabled:!0})," ","Deliver the work"]}),"\n",(0,i.jsxs)(t.li,{className:"task-list-item",children:[(0,i.jsx)(t.input,{type:"checkbox",disabled:!0})," ","Send the invoice"]}),"\n",(0,i.jsxs)(t.li,{className:"task-list-item",children:[(0,i.jsx)(t.input,{type:"checkbox",disabled:!0})," ","Get paid"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Below is the operation history of the to-do list document. As you can see, the operations are logged in the order they were executed."}),"\n",(0,i.jsxs)("figure",{className:"image-container",children:[(0,i.jsx)("img",{src:o(5145).A,alt:"Operation history in Connect"}),(0,i.jsx)("figcaption",{children:(0,i.jsx)(t.p,{children:"The operation history of the to-do list document, showing each change made."})})]}),"\n",(0,i.jsx)(t.p,{children:"Now that we have some data in our document model, we can query it through the GraphQL API."}),"\n",(0,i.jsx)(t.h3,{id:"option-1-query-your-document-via-the-switchboard-api-button",children:"Option 1: Query your document via the Switchboard API Button."}),"\n",(0,i.jsxs)(t.p,{children:["Whenever you want to start a query from a document within Connect, you can open Switchboard by clicking the Switchboard icon in the top right-hand corner of the document editor interface.\nThe Switchboard API button at the top of your document model will get you the complete state of your current document.\nThis will prepopulate the Apollo Studio Sandbox with the correct ",(0,i.jsx)(t.strong,{children:"DocumentID"})," for your document model."]}),"\n",(0,i.jsxs)("figure",{className:"image-container",children:[(0,i.jsx)("img",{src:o(826).A,alt:"Switchboard button in document editor"}),(0,i.jsx)("figcaption",{children:(0,i.jsx)(t.p,{children:"The Switchboard button provides a direct link to the GraphQL API for the\ndocument."})})]}),"\n",(0,i.jsx)(t.h3,{id:"option-2-query-your-document-by-document-id",children:"Option 2: Query your document by document ID"}),"\n",(0,i.jsx)(t.p,{children:"In your Document Toolbar, you will find an icon to visit your operations history. At the top of the toolbar, you will find your document ID.\nCopy this ID to use it in the Switchboard API."}),"\n",(0,i.jsxs)("figure",{className:"image-container",children:[(0,i.jsx)("img",{src:o(8172).A,alt:"Copy the DocumentID"}),(0,i.jsx)("figcaption",{children:(0,i.jsx)(t.p,{children:"You can copy your Document ID from your operations history."})})]}),"\n",(0,i.jsxs)(t.p,{children:["When you navigate to your Switchboard endpoint by adding ",(0,i.jsx)(t.strong,{children:(0,i.jsx)(t.code,{children:"/graphql/system"})})," to the end of your URL. (e.g., ",(0,i.jsx)(t.a,{href:"http://localhost:4001/graphql/system",children:"http://localhost:4001/graphql/system"}),", ",(0,i.jsx)(t.a,{href:"https://switchboard.phd/graphql/system",children:"https://switchboard.phd/graphql/system"}),", or add it to a custom domain), you can use this document ID to query the state of your document.\nThe documentation on the left-hand side of the Apollo Sandbox will show you all the different fields that are available to query."]}),"\n",(0,i.jsxs)("figure",{className:"image-container",children:[(0,i.jsx)("img",{src:o(7606).A,alt:"Apollo Studio with document query"}),(0,i.jsx)("figcaption",{children:(0,i.jsx)(t.p,{children:"The Apollo Studio Sandbox showing the available fields for querying a\ndocument."})})]}),"\n",(0,i.jsx)(t.h3,{id:"option-3-search-for-your-document-id-via-graphql",children:"Option 3: Search for your document ID via GraphQL"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Alternatively"}),", we can use our Reactor URL and endpoint to figure out the document ID.\ne.g., ",(0,i.jsx)(t.a,{href:"http://localhost:4001/graphql/system",children:"http://localhost:4001/graphql/system"}),", ",(0,i.jsx)(t.a,{href:"https://switchboard.phd/graphql/system",children:"https://switchboard.phd/graphql/system"})," or your custom ",(0,i.jsx)(t.a,{href:"https://switchboard.domain/graphql/system",children:"https://switchboard.domain/graphql/system"})]}),"\n",(0,i.jsx)(t.p,{children:"We can find out the ID of our document by querying the drive for its documents.\nSince we only have one document in our drive, this query will return the ID of our to-do list document."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-graphQL",metastring:'title="Document ID Query"',children:"query Query {\n  ToDoList {\n    getDocuments {\n      id\n      name\n      documentType\n      revision\n      created\n      lastModified\n    }\n  }\n}\n"})}),"\n",(0,i.jsxs)(t.p,{children:["This example query is structured to request all documents of type ",(0,i.jsx)(t.code,{children:"ToDoList"})," from the drive.\nIt extracts common metadata fields such as ",(0,i.jsx)(t.strong,{children:"id"}),", ",(0,i.jsx)(t.strong,{children:"name"}),", ",(0,i.jsx)(t.strong,{children:"documentType"}),", ",(0,i.jsx)(t.strong,{children:"revision"}),", ",(0,i.jsx)(t.strong,{children:"created"}),", and ",(0,i.jsx)(t.strong,{children:"lastModified"}),"."]}),"\n",(0,i.jsx)(t.h3,{id:"get-the-state-of-the-document",children:"Get the state of the document"}),"\n",(0,i.jsx)(t.p,{children:"Once you've found your document via any of the three options above, you'll be able to query its state."}),"\n",(0,i.jsx)(t.p,{children:"In the previous step, we queried for document metadata. Now let's query for the actual content of the document state."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-graphql",metastring:'title="Get the Document state"',children:"query getDocument($documentId: PHID!, $driveId: String) {\n  ToDoList {\n    getDocument(docId: $documentId, driveId: $driveId) {\n      id\n      created\n      lastModified\n      name\n      revision\n      state {\n        items {\n          id\n          text\n          checked\n        }\n        stats {\n          total\n          checked\n          unchecked\n        }\n      }\n    }\n  }\n}\n"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-graphql",metastring:'title="Example variables"',children:'{\n  "documentId": "03eb6780-f1d7-438c-84a0-6d93dfb8f6af", // or replace this with your specific doc ID\n  "driveId": "powerhouse" // or replace this with your specific driveId\n}\n'})}),"\n",(0,i.jsx)(t.p,{children:"This query will return the current state of the document, including all to-do items and stats."}),"\n",(0,i.jsxs)("figure",{className:"image-container",children:[(0,i.jsx)("img",{src:o(888).A,alt:"Executing a mutation for a to-do item in Apollo Studio"}),(0,i.jsx)("figcaption",{children:(0,i.jsxs)(t.p,{children:["The Apollo Studio Sandbox showing the ",(0,i.jsx)("code",{children:"addTodoItem"})," mutation. You\ncan see the variables passed in and the response from the server."]})})]}),"\n",(0,i.jsx)(t.h2,{id:"mutate-the-state-of-a-document",children:"Mutate the state of a document"}),"\n",(0,i.jsx)(t.p,{children:"Now that we know how to query the state of a document, we can start to write to it."}),"\n",(0,i.jsxs)(t.p,{children:["To perform write operations, we use ",(0,i.jsx)(t.strong,{children:"GraphQL Mutations"}),". Mutations are similar to queries, but they are used to create, update, or delete data. For our To-do List, we'll want to add, check, and remove items."]}),"\n",(0,i.jsx)(t.h3,{id:"adding-a-new-to-do-item",children:"Adding a new to-do item"}),"\n",(0,i.jsxs)(t.p,{children:["Let's start by adding a new item to our list. The document model for our to-do list has an ",(0,i.jsx)(t.code,{children:"ADD_TODO_ITEM"})," operation, which translates to an ",(0,i.jsx)(t.code,{children:"addTodoItem"})," mutation in GraphQL.\nTo use this mutation, you need to provide the ",(0,i.jsx)(t.code,{children:"docId"})," of the to-do list you want to modify, and the ",(0,i.jsx)(t.code,{children:"text"})," and ",(0,i.jsx)(t.code,{children:"id"})," for the new to-do item. We'll specify these via variables."]}),"\n",(0,i.jsx)(t.p,{children:"Here is an example of how to structure the mutation:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-graphql",metastring:'title="example-add-mutation"',children:"mutation Mutation($docId: PHID, $input: ToDoList_AddTodoItemInput) {\n  ToDoList_addTodoItem(docId: $docId, input: $input)\n}\n"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-graphql",metastring:'title="example-variables"',children:'{\n  "docId": "03eb6780-f1d7-438c-84a0-6d93dfb8f6af",\n  "input": {\n    "text": "My new to-do from GraphQL",\n    "id": "1"\n  }\n}\n'})}),"\n",(0,i.jsxs)(t.p,{children:["Replace the example ",(0,i.jsx)(t.code,{children:"docId"})," with the actual ID of your document. You can get this ID by querying the drive as we did before."]}),"\n",(0,i.jsx)(t.p,{children:"When you execute this mutation in Apollo Studio, it will add the new item to your to-do list. The response will return the number of to-do's on your list."}),"\n",(0,i.jsx)(t.h3,{id:"deleting-a-to-do-item",children:"Deleting a to-do item"}),"\n",(0,i.jsxs)(t.p,{children:["To delete an item, you'll need its unique identifier. When you query for the to-do items in your list, each one will have an ",(0,i.jsx)(t.code,{children:"id"}),". You'll use this ",(0,i.jsx)(t.code,{children:"id"})," to specify which item to delete."]}),"\n",(0,i.jsxs)(t.p,{children:["The document model provides a ",(0,i.jsx)(t.code,{children:"DELETE_TODO_ITEM"})," operation, which corresponds to a ",(0,i.jsx)(t.code,{children:"deleteTodoItem"})," mutation."]}),"\n",(0,i.jsx)(t.p,{children:"Here's how you can use it:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-graphql",metastring:'title="example-delete-mutation"',children:"mutation Mutation($docId: PHID, $input: ToDoList_DeleteTodoItemInput) {\n  ToDoList_deleteTodoItem(docId: $docId, input: $input)\n}\n"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-graphql",metastring:'title="example-variables"',children:'{\n  "docId": "03eb6780-f1d7-438c-84a0-6d93dfb8f6af",\n  "input": {\n    "id": "0.6325811781889789"\n  }\n}\n'})}),"\n",(0,i.jsxs)(t.p,{children:["Make sure to replace the ",(0,i.jsx)(t.code,{children:"docId"})," and ",(0,i.jsx)(t.code,{children:"id"})," with the appropriate values for your document and the item you wish to delete."]}),"\n",(0,i.jsx)(t.p,{children:"After executing this mutation, the specified to-do item will be removed from your list."}),"\n",(0,i.jsx)(t.h3,{id:"verifying-the-changes",children:"Verifying the changes"}),"\n",(0,i.jsx)(t.p,{children:"After performing a write mutation, you can verify that the change was successful in a couple of ways:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Query the document state again:"})," Rerun the ",(0,i.jsx)(t.code,{children:"getDocument"})," query from earlier in this tutorial. You should see the new item in the list or the deleted item removed."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Check the Operation History:"})," The operation history in Connect will show the new ",(0,i.jsx)(t.code,{children:"ADD_TODO_ITEM"})," or ",(0,i.jsx)(t.code,{children:"DELETE_TODO_ITEM"})," operation, along with who performed it and when. This provides a complete audit trail of all changes to the document."]}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(t.p,{children:"This ability to programmatically read from and write to documents via the GraphQL API is a powerful feature of Powerhouse. It unlocks countless possibilities for integrating your structured data into other applications, building automated workflows, and creating rich, data-driven user experiences."})]})}function l(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8172:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/DocumentID-2683032342bce76357df7e62820e596c.png"}}]);