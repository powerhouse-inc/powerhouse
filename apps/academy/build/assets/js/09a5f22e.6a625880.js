"use strict";(self.webpackChunk_powerhousedao_academy=self.webpackChunk_powerhousedao_academy||[]).push([[4599],{328:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"academy/MasteryTrack/WorkWithData/Analytics Engine/GraphQL References/QueryingADocumentWithGraphQL","title":"Querying a document with GraphQL","description":"Overview","source":"@site/docs/academy/02-MasteryTrack/04-WorkWithData/06-Analytics Engine/GraphQL References/QueryingADocumentWithGraphQL.md","sourceDirName":"academy/02-MasteryTrack/04-WorkWithData/06-Analytics Engine/GraphQL References","slug":"/academy/MasteryTrack/WorkWithData/Analytics Engine/GraphQL References/QueryingADocumentWithGraphQL","permalink":"/academy/MasteryTrack/WorkWithData/Analytics Engine/GraphQL References/QueryingADocumentWithGraphQL","draft":false,"unlisted":false,"editUrl":"https://github.com/powerhouse-inc/powerhouse-docs/tree/dev/docs/academy/02-MasteryTrack/04-WorkWithData/06-Analytics Engine/GraphQL References/QueryingADocumentWithGraphQL.md","tags":[],"version":"current","frontMatter":{},"sidebar":"academySidebar","previous":{"title":"Best practices","permalink":"/academy/MasteryTrack/WorkWithData/Analytics Engine/best-practices"},"next":{"title":"Drive analytics","permalink":"/academy/MasteryTrack/WorkWithData/drive-analytics"}}');var s=i(5723),r=i(7474);const o={},c="Querying a document with GraphQL",d={},a=[{value:"Overview",id:"overview",level:2},{value:"1. The complete state of the document:",id:"1-the-complete-state-of-the-document",level:4},{value:"2. Only the latest changes and updates:",id:"2-only-the-latest-changes-and-updates",level:4},{value:"Adding the specific document drive to Connect with a URL",id:"adding-the-specific-document-drive-to-connect-with-a-url",level:3},{value:"Querying data from Connect with Switchboard",id:"querying-data-from-connect-with-switchboard",level:2},{value:"Querying data from Connect in Apollo Studio",id:"querying-data-from-connect-in-apollo-studio",level:2},{value:"1. Querying the complete state of a document",id:"1-querying-the-complete-state-of-a-document",level:3},{value:"Common document fields",id:"common-document-fields",level:4},{value:"Real World Assets (RWA) Specific Fields",id:"real-world-assets-rwa-specific-fields",level:4},{value:"2. Querying for the latest updates or specific documents",id:"2-querying-for-the-latest-updates-or-specific-documents",level:3},{value:"2.1 Registering a listener",id:"21-registering-a-listener",level:3},{value:"2.2 Defining the filter",id:"22-defining-the-filter",level:3}];function l(e){const n={admonition:"admonition",blockquote:"blockquote",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"querying-a-document-with-graphql",children:"Querying a document with GraphQL"})}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:["In this documentation we'll show how to use a ",(0,s.jsx)(n.strong,{children:"GraphQL"})," query to query a document model."]}),"\n",(0,s.jsxs)(n.p,{children:["We will be looking at 2 different GraphQL queries for retrieving data from a 'Real World Asset Portfolio Report'.\nBut the ",(0,s.jsx)(n.strong,{children:"same queries can be used for any other document model"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"The queries below focus on 2 different ways of receiving the data.\nWe will show how you can receive:"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.h4,{id:"1-the-complete-state-of-the-document",children:"1. The complete state of the document:"}),"\n",(0,s.jsx)(n.p,{children:"Such as the array of accounts, Special Purpose Vehicles (SPVs), fixed income types, fee types, portfolio details, and transactions associated with a particular RWA-report."}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.h4,{id:"2-only-the-latest-changes-and-updates",children:"2. Only the latest changes and updates:"}),"\n",(0,s.jsx)(n.p,{children:"Or specific operations of a document by registering a listener with a specific filter."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"adding-the-specific-document-drive-to-connect-with-a-url",children:"Adding the specific document drive to Connect with a URL"}),"\n",(0,s.jsx)(n.p,{children:"The specific drive where your RWA-report or any other document is being stored can be accessed through Connect. Connect functions as your decentralised document drive to access and edit document models that capture the data present in your organisation."}),"\n",(0,s.jsx)(n.p,{children:"Get access to an organisations drive instances by adding this drive to your Connect Drive navigation tree view. click the (+) to add a public drive with the help of the correct link. To add a new drive you'll have to know the correct URL for the drive."}),"\n",(0,s.jsx)(n.h2,{id:"querying-data-from-connect-with-switchboard",children:"Querying data from Connect with Switchboard"}),"\n",(0,s.jsx)(n.p,{children:"Whenever you want to start a query from a document within connect you can open up switchboard by looking for the switchboard logo in the top right hand corner of the document editor interface, or by clicking a document in the connect drive explorer and opening the document in switchboard. This feature will not be available for your local drives as they are not hosted on switchboard."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.img,{alt:"untitled",src:i(1374).A+"",width:"535",height:"411"}),(0,s.jsx)(n.br,{}),"\n","Right click a document and find a direct link to switchboard GraphQL playground*"]}),"\n",(0,s.jsx)(n.h2,{id:"querying-data-from-connect-in-apollo-studio",children:"Querying data from Connect in Apollo Studio"}),"\n",(0,s.jsx)(n.p,{children:"Aside from switchboard you're able to make use of GraphQL interfaces such as Apollo Studio.\nWhen opening the document in switchboard the endpoint will be visible at the top of the interface. Copy this endpoint and use it as your API endpoint in Apollo."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.img,{alt:"untitled",src:i(9205).A+"",width:"781",height:"307"}),"\n",(0,s.jsx)(n.em,{children:"The endpoint you'll be using for any other GraphQL playgrounds or sandboxes"})]}),"\n",(0,s.jsx)(n.h3,{id:"1-querying-the-complete-state-of-a-document",children:"1. Querying the complete state of a document"}),"\n",(0,s.jsxs)(n.p,{children:["This example query is structured to request a document by its unique identifier (id).",(0,s.jsx)(n.br,{}),"\n","It extracts common fields such as id, name, documentType, revision, created, and lastModified."]}),"\n",(0,s.jsx)(n.p,{children:"Additionally, it retrieves specific data related to the 'Real World Assets' document model, including accounts, SPVs, fixed income types, fee types, portfolio, and transactions. The RWA section of the query is designed to pull in detailed information about the financial structure and transactions of real-world assets managed within the document model."}),"\n",(0,s.jsx)(n.h4,{id:"common-document-fields",children:"Common document fields"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"name"}),": The name of the document."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"documentType"}),": The type classification of the document."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"revision"}),": The version number of the document."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"created"}),": The creation timestamp of the document."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"lastModified"}),": The timestamp of when the document was last modified."]}),"\n"]}),"\n",(0,s.jsxs)(t,{children:[(0,s.jsx)("summary",{children:"List of document model specific fields."}),(0,s.jsx)(n.h4,{id:"real-world-assets-rwa-specific-fields",children:"Real World Assets (RWA) Specific Fields"}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"State"})}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"accounts"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"id"}),": Unique identifier for the account."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"reference"}),": Reference code or number associated with the account."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"label"}),": A user-friendly name or label for the account."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"principalLenderAccountId"}),": Identifier for the principal lender's account."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"spvs"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"id"}),": Unique identifier for the Special Purpose Vehicle (SPV)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"name"}),": Name of the SPV."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"feeTypes"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"id"}),": Unique identifier for the fee type."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"name"}),": Name of the fee type."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"feeType"}),": The classification or category of the fee."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"accountId"}),": Identifier for the account associated with the fee."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"fixedIncomeTypes"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"id"}),": Unique identifier for the fixed income type."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"name"}),": Name of the fixed income type."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Portfolio"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Fixed Income"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"id"}),": Unique identifier for the fixed income asset."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"fixedIncomeTypeId"}),": Identifier for the type of fixed income."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"name"}),": Name of the fixed income asset."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"spvId"}),": Identifier for the SPV associated with the fixed income asset."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"maturity"}),": Maturity date of the fixed income asset."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"purchaseDate"}),": Purchase date of the fixed income asset."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"notional"}),": The notional amount of the fixed income asset."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"purchasePrice"}),": Purchase price of the fixed income asset."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"purchaseProceeds"}),": Proceeds from the purchase of the fixed income asset."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"totalDiscount"}),": Total discount received for the fixed income asset."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"annualizedYield"}),": The annualized yield of the fixed income asset."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ISIN"}),": International Securities Identification Number for the fixed income asset."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"CUSIP"}),": Committee on Uniform Securities Identification Procedures number for the fixed income asset."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"coupon"}),": Coupon rate of the fixed income asset."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Cash"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"id"}),": Unique identifier for the cash holding."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"spvId"}),": Identifier for the SPV associated with the cash holding."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"currency"}),": Currency of the cash holding"]}),"\n"]}),"\n"]}),"\n"]})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",metastring:'title="An example query for the full state of a document"',children:'query {\n  document(id: "") {\n    name\n    documentType\n    revision\n    created\n    lastModified\n    ... on RealWorldAssets {\n      state {\n        accounts {\n          id\n          reference\n          label\n        }\n        principalLenderAccountId\n        spvs {\n          id\n          name\n        }\n        serviceProviderFeeTypes {\n          id\n          name\n          feeType\n          accountId\n        }\n        fixedIncomeTypes {\n          id\n          name\n        }\n        portfolio {\n          ... on FixedIncome {\n            id\n            fixedIncomeTypeId\n            name\n            spvId\n            maturity\n            purchaseDate\n            notional\n            purchasePrice\n            purchaseProceeds\n            totalDiscount\n            annualizedYield\n            ISIN\n            CUSIP\n            coupon\n          }\n          ... on Cash {\n            id\n            spvId\n            currency\n          }\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"2-querying-for-the-latest-updates-or-specific-documents",children:"2. Querying for the latest updates or specific documents"}),"\n",(0,s.jsx)(n.p,{children:"This query is particularly useful when you only need the latest changes from the document drive."}),"\n",(0,s.jsx)(n.h3,{id:"21-registering-a-listener",children:"2.1 Registering a listener"}),"\n",(0,s.jsx)(n.p,{children:"For this purpose we support adding listeners through a graphQL mutation such as the PullResponderListenerbelow."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"mutation registerListener($filter: InputListenerFilter!) {\n  registerPullResponderListener(filter: $filter) {\n    listenerId\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"22-defining-the-filter",children:"2.2 Defining the filter"}),"\n",(0,s.jsxs)(n.p,{children:["Through this listener you can define the filter with query variables.",(0,s.jsx)(n.br,{}),"\n","This allows you to filter for specific document ID's or a lists, documentTypes, scopes or branches.",(0,s.jsx)(n.br,{}),"\n","Branches allow you to query different versions of a document in case there is a conflict accross different versions of the document or when contributors are maintaining separate versions with the help of branching"]}),"\n",(0,s.jsx)(n.p,{children:"In this case we're filtering by document type makerdao/rwa-portfolio."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:'{\n  "filter":{\n    "documentId": ["*"],\n    "documentType": ["makerdao/rwa-portfolio"],\n    "scope": "global",\n    "branch": "main"\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"This combination of query + query variables will return a listenerID which can be used in the next step to query for specific strands."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.img,{alt:"untitled",src:i(6118).A+"",width:"3022",height:"1202"}),"\n",(0,s.jsx)(n.em,{children:"An example of registering a listener and receiving a listenerId back."})]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"A strand in this scenario can be understood as a list of operations that has been applied to the RWA portfolio or any other document. As a query variable you'll want to add the received listenerId from the previous step together with the pullstrands query below"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",metastring:'title="Pullstrands query"',children:"query pullStrands($listenerId: ID, $since: Date) {\n  system {\n    sync {\n      strands(listenerId: $listenerId, since: $since) {\n        driveId\n        documentId\n        scope\n        branch\n        operations {\n          index\n          skip\n          type\n          input\n          hash\n          timestamp\n        }\n      }\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",metastring:'title="Query variables for pullStrands"',children:'{\n  "listenerId":"7ef04e24-4466-4642-863d-4a71c29d30c7",\n  "since":"2024-02-21T16:45:30.300Z"\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.img,{alt:"untitled",src:i(2510).A+"",width:"3024",height:"1522"}),"\n",(0,s.jsx)(n.em,{children:"An example of using the ListenerID to pull specific strands (or document operations)"})]}),"\n",(0,s.jsx)(n.p,{children:"In case you'd only like to receive the latest operations of a document the latest timestamp can be used as a filter in the since query variable to only get the most relevant or latest changes."}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:'A "strand" within the context of Powerhouse\'s Document Synchronization Protocol also refers to a single synchronization channel that connects exactly one unit of synchronization to another, with all four parameters (drive_url, doc_id, scope, branch) set to fixed values. This setup means that synchronization happens at a granular level, focusing specifically on one precise aspect of synchronization between two distinct points of instances of a document or document drive.'})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},1374:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/raw-reports1-3c851234e07c9245349312cfb43851e8.png"},2510:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/listener-raw-903224f65266fc8dd543de38991610f3.png"},6118:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/rwaRegister-8b380ddd1ae984c7e67c826bb7c57e67.png"},7474:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>c});var t=i(2155);const s={},r=t.createContext(s);function o(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(r.Provider,{value:n},e.children)}},9205:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/raw-reports2-755c3a119a6742ae796fc3d696cb937a.png"}}]);