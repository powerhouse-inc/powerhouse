"use strict";(self.webpackChunk_powerhousedao_academy=self.webpackChunk_powerhousedao_academy||[]).push([[7627],{7474:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>d});var i=t(2155);const s={},r=i.createContext(s);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:n},e.children)}},9188:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"academy/APIReferences/PHDocumentMigrationGuide","title":"PHDocument Migration Guide","description":"This guide covers the breaking changes introduced in Powerhouse v4.0.0 related to PHDocument structure changes. If you\'re upgrading from v3.2.0 or earlier, this migration is required and document models must be regenerated.","source":"@site/docs/academy/04-APIReferences/05-PHDocumentMigrationGuide.md","sourceDirName":"academy/04-APIReferences","slug":"/academy/APIReferences/PHDocumentMigrationGuide","permalink":"/academy/APIReferences/PHDocumentMigrationGuide","draft":false,"unlisted":false,"editUrl":"https://github.com/powerhouse-inc/powerhouse-docs/tree/dev/docs/academy/04-APIReferences/05-PHDocumentMigrationGuide.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"academySidebar","previous":{"title":"Relational Database","permalink":"/academy/APIReferences/RelationalDatabase"},"next":{"title":"Document-Engineering","permalink":"/academy/ComponentLibrary/DocumentEngineering"}}');var s=t(5723),r=t(7474);const o={},d="PHDocument Migration Guide",c={},a=[{value:"Overview",id:"overview",level:2},{value:"What Changed",id:"what-changed",level:2},{value:"Document Structure Refactor",id:"document-structure-refactor",level:3},{value:"Complete Property Migration Map",id:"complete-property-migration-map",level:2},{value:"Step-by-Step Migration Guide",id:"step-by-step-migration-guide",level:2},{value:"Step 1: Update Document Property Access",id:"step-1-update-document-property-access",level:3},{value:"Step 2: Update Component Code",id:"step-2-update-component-code",level:3},{value:"Step 3: Update Type Definitions",id:"step-3-update-type-definitions",level:3},{value:"Step 4: Database Queries and APIs Compatibility",id:"step-4-database-queries-and-apis-compatibility",level:3},{value:"Common Migration Issues and Solutions",id:"common-migration-issues-and-solutions",level:2},{value:"Issue 1: Undefined Property Errors",id:"issue-1-undefined-property-errors",level:3},{value:"Issue 2: Revision Type Mismatch",id:"issue-2-revision-type-mismatch",level:3},{value:"Issue 3: Date Format Changes",id:"issue-3-date-format-changes",level:3},{value:"Testing Your Migration",id:"testing-your-migration",level:2},{value:"Automated Testing",id:"automated-testing",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"phdocument-migration-guide",children:"PHDocument Migration Guide"})}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["This guide covers the ",(0,s.jsx)(n.strong,{children:"breaking changes"})," introduced in Powerhouse v4.0.0 related to PHDocument structure changes. If you're upgrading from v3.2.0 or earlier, ",(0,s.jsx)(n.strong,{children:"this migration is required"})," and document models must be regenerated."]})}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:["Version 4.0.0 introduced a significant refactor of the ",(0,s.jsx)(n.code,{children:"PHDocument"})," structure that consolidates document metadata into a ",(0,s.jsx)(n.code,{children:"header"})," field. This change enables signed and unsigned documents with cryptographic verification capabilities, but requires updating all code that accesses document properties."]}),"\n",(0,s.jsx)(n.h2,{id:"what-changed",children:"What Changed"}),"\n",(0,s.jsx)(n.h3,{id:"document-structure-refactor",children:"Document Structure Refactor"}),"\n",(0,s.jsxs)(n.p,{children:["The most significant change is the consolidation of document metadata into a ",(0,s.jsx)(n.code,{children:"header"})," field. Previously, document properties were scattered at the root level of the document object."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Before (v3.2.0 and earlier):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'const document = {\n  id: "doc-123",\n  created: "2023-01-01T00:00:00.000Z",\n  lastModified: "2023-01-01T12:00:00.000Z",\n  revision: 5,\n  documentType: "powerhouse/todolist",\n  name: "My Todo List",\n  slug: "my-todo-list",\n  // ... other properties\n};\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"After (v4.0.0):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'const document = {\n  header: {\n    id: "doc-123",\n    createdAtUtcIso: "2023-01-01T00:00:00.000Z",\n    lastModifiedAtUtcIso: "2023-01-01T12:00:00.000Z",\n    revision: { global: 5, local: 0 },\n    documentType: "powerhouse/todolist",\n    name: "My Todo List",\n    slug: "my-todo-list",\n    branch: "main",\n    sig: { nonce: "", publicKey: {} },\n    meta: {},\n  },\n  // ... other properties\n};\n'})}),"\n",(0,s.jsx)(n.h2,{id:"complete-property-migration-map",children:"Complete Property Migration Map"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:(0,s.jsx)(n.strong,{children:"Old Property"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.strong,{children:"New Property"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.strong,{children:"Additional Changes"})})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"document.id"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"document.header.id"})}),(0,s.jsx)(n.td,{children:"Now an Ed25519 signature for signed documents"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"document.created"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"document.header.createdAtUtcIso"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.strong,{children:"Renamed"})," to include UTC ISO specification"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"document.lastModified"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"document.header.lastModifiedAtUtcIso"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.strong,{children:"Renamed"})," to include UTC ISO specification"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"document.revision"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"document.header.revision"})}),(0,s.jsxs)(n.td,{children:["Now an ",(0,s.jsx)(n.strong,{children:"object"})," with scope keys (e.g., ",(0,s.jsx)(n.code,{children:"{ global: 5, local: 0 }"}),")"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"document.documentType"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"document.header.documentType"})}),(0,s.jsx)(n.td,{children:"No additional changes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"document.name"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"document.header.name"})}),(0,s.jsx)(n.td,{children:"No additional changes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"document.slug"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"document.header.slug"})}),(0,s.jsx)(n.td,{children:"No additional changes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"document.branch"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"document.header.branch"})}),(0,s.jsx)(n.td,{children:"Now explicitly included"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"document.meta"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"document.header.meta"})}),(0,s.jsx)(n.td,{children:"Now explicitly included"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"N/A"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"document.header.sig"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.strong,{children:"New"})," - Signature information for document verification"]})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"step-by-step-migration-guide",children:"Step-by-Step Migration Guide"}),"\n",(0,s.jsx)(n.h3,{id:"step-1-update-document-property-access",children:"Step 1: Update Document Property Access"}),"\n",(0,s.jsx)(n.p,{children:"Replace all instances of direct property access with header-based access:"}),"\n",(0,s.jsxs)(t,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)(n.strong,{children:"Common Property Access Patterns"})}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Document ID Access:"})}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Before\nconst documentId = document.id;\n\n// After\nconst documentId = document.header.id;\n"})}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Document Name Access:"})}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Before\nconst documentName = document.name;\n\n// After\nconst documentName = document.header.name;\n"})}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Document Type Access:"})}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Before\nconst docType = document.documentType;\n\n// After\nconst docType = document.header.documentType;\n"})}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Timestamp Access:"})}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Before\nconst created = document.created;\nconst lastModified = document.lastModified;\n\n// After\nconst created = document.header.createdAtUtcIso;\nconst lastModified = document.header.lastModifiedAtUtcIso;\n"})}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Revision Access:"})}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Before\nconst revision = document.revision; // Was a number\n\n// After\nconst globalRevision = document.header.revision.global; // Now an object\nconst localRevision = document.header.revision.local;\n// Or get all revisions\nconst allRevisions = document.header.revision; // { global: 5, local: 0, ... }\n"})})]}),"\n",(0,s.jsx)(n.h3,{id:"step-2-update-component-code",children:"Step 2: Update Component Code"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"React Components:"})}),"\n",(0,s.jsxs)(t,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)(n.strong,{children:"Example: Document List Component"})}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsx",children:'// Before\nfunction DocumentList({ documents }) {\n  return (\n    <div>\n      {documents.map((doc) => (\n        <div key={doc.id} className="document-item">\n          <h3>{doc.name}</h3>\n          <p>Type: {doc.documentType}</p>\n          <p>\n            Last modified: {new Date(doc.lastModified).toLocaleDateString()}\n          </p>\n          <p>Revision: {doc.revision}</p>\n        </div>\n      ))}\n    </div>\n  );\n}\n\n// After\nfunction DocumentList({ documents }) {\n  return (\n    <div>\n      {documents.map((doc) => (\n        <div key={doc.header.id} className="document-item">\n          <h3>{doc.header.name}</h3>\n          <p>Type: {doc.header.documentType}</p>\n          <p>\n            Last modified:{" "}\n            {new Date(doc.header.lastModifiedAtUtcIso).toLocaleDateString()}\n          </p>\n          <p>Global Revision: {doc.header.revision.global}</p>\n        </div>\n      ))}\n    </div>\n  );\n}\n'})})]}),"\n",(0,s.jsx)(n.h3,{id:"step-3-update-type-definitions",children:"Step 3: Update Type Definitions"}),"\n",(0,s.jsx)(n.p,{children:"If you're using TypeScript, update your type definitions:"}),"\n",(0,s.jsxs)(t,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)(n.strong,{children:"TypeScript Interface Updates"})}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Before\ninterface MyDocument {\n  id: string;\n  name: string;\n  documentType: string;\n  created: string;\n  lastModified: string;\n  revision: number;\n  // ... other properties\n}\n\n// After\ninterface MyDocument {\n  header: {\n    id: string;\n    name: string;\n    documentType: string;\n    createdAtUtcIso: string;\n    lastModifiedAtUtcIso: string;\n    revision: {\n      [scope: string]: number;\n    };\n    slug: string;\n    branch: string;\n    sig: {\n      nonce: string;\n      publicKey: any;\n    };\n    meta?: {\n      preferredEditor?: string;\n    };\n  };\n  // ... other properties\n}\n"})})]}),"\n",(0,s.jsx)(n.h3,{id:"step-4-database-queries-and-apis-compatibility",children:"Step 4: Database Queries and APIs Compatibility"}),"\n",(0,s.jsxs)(t,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)(n.strong,{children:"GraphQL Query Compatibility"})}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"GraphQL Queries:"})}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-graphql",children:"# Your existing queries continue to work unchanged\nquery GetDocument($id: ID!) {\n  document(id: $id) {\n    id # Still works due to response transformation\n    name # Still works due to response transformation\n    documentType # Still works due to response transformation\n    created # Still works due to response transformation\n    lastModified # Still works due to response transformation\n    revision # Still works due to response transformation\n  }\n}\n"})}),(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"GraphQL Backward Compatibility:"})," The GraphQL API maintains backward compatibility through response transformation. Your existing queries will continue to work without changes. However, when working with the raw document objects in your application code, you'll need to use the new header structure."]})})]}),"\n",(0,s.jsx)(n.h2,{id:"common-migration-issues-and-solutions",children:"Common Migration Issues and Solutions"}),"\n",(0,s.jsx)(n.h3,{id:"issue-1-undefined-property-errors",children:"Issue 1: Undefined Property Errors"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Problem:"})," Getting ",(0,s.jsx)(n.code,{children:"undefined"})," when accessing document properties."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solution:"})," Update property access to use the header structure:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// This will be undefined after migration\nconst name = document.name;\n\n// Use this instead\nconst name = document.header.name;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"issue-2-revision-type-mismatch",children:"Issue 2: Revision Type Mismatch"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Problem:"})," Code expecting revision to be a number but getting an object."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solution:"})," Update revision access to specify the scope:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Before - revision was a number\nif (document.revision > 5) { ... }\n\n// After - revision is an object with scope keys\nif (document.header.revision.global > 5) { ... }\n"})}),"\n",(0,s.jsx)(n.h3,{id:"issue-3-date-format-changes",children:"Issue 3: Date Format Changes"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Problem:"})," Date parsing issues due to property name changes."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solution:"})," Update timestamp property names:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Before\nconst createdDate = new Date(document.created);\nconst modifiedDate = new Date(document.lastModified);\n\n// After\nconst createdDate = new Date(document.header.createdAtUtcIso);\nconst modifiedDate = new Date(document.header.lastModifiedAtUtcIso);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"testing-your-migration",children:"Testing Your Migration"}),"\n",(0,s.jsx)(n.h3,{id:"automated-testing",children:"Automated Testing"}),"\n",(0,s.jsx)(n.p,{children:"Create tests to verify your migration:"}),"\n",(0,s.jsxs)(t,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)(n.strong,{children:"Migration Test Examples"})}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// Test document property access\ndescribe("Document Migration", () => {\n  it("should access document properties correctly", () => {\n    const mockDocument = {\n      header: {\n        id: "test-id",\n        name: "Test Document",\n        documentType: "powerhouse/test",\n        createdAtUtcIso: "2023-01-01T00:00:00.000Z",\n        lastModifiedAtUtcIso: "2023-01-01T12:00:00.000Z",\n        revision: { global: 5, local: 0 },\n        // ... other header properties\n      },\n      // ... other document properties\n    };\n\n    // Test property access\n    expect(mockDocument.header.id).toBe("test-id");\n    expect(mockDocument.header.name).toBe("Test Document");\n    expect(mockDocument.header.revision.global).toBe(5);\n  });\n});\n'})})]}),"\n",(0,s.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/academy/Architecture/PowerhouseArchitecture",children:"PHDocument Architecture"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/academy/MasteryTrack/DocumentModelCreation/WhatIsADocumentModel",children:"Document Model Creation"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/academy/APIReferences/ReactHooks",children:"React Hooks"})}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.em,{children:["This migration guide covers the major changes in v4.0.0. For additional technical details, refer to the ",(0,s.jsx)(n.a,{href:"https://github.com/powerhouse-dao/powerhouse/blob/main/RELEASE-NOTES.md",children:"RELEASE-NOTES.md"})," in the main repository."]})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}}}]);