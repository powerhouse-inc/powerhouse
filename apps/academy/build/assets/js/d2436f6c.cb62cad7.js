"use strict";(self.webpackChunk_powerhousedao_academy=self.webpackChunk_powerhousedao_academy||[]).push([[9939],{4055:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"academy/MasteryTrack/WorkWithData/Analytics Engine/graphql/integration","title":"Integration","description":"The analytics-engine-graphql module provides types and resolvers needed for a fully-functional GraphQL Server API. This library has no dependencies on any particular server but has been tested using Apollo Server 3 and 4.","source":"@site/docs/academy/02-MasteryTrack/04-WorkWithData/06-Analytics Engine/graphql/integration.md","sourceDirName":"academy/02-MasteryTrack/04-WorkWithData/06-Analytics Engine/graphql","slug":"/academy/MasteryTrack/WorkWithData/Analytics Engine/graphql/integration","permalink":"/academy/MasteryTrack/WorkWithData/Analytics Engine/graphql/integration","draft":false,"unlisted":false,"editUrl":"https://github.com/powerhouse-inc/powerhouse-docs/tree/dev/docs/academy/02-MasteryTrack/04-WorkWithData/06-Analytics Engine/graphql/integration.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"academySidebar","previous":{"title":"GraphQL API","permalink":"/academy/MasteryTrack/WorkWithData/Analytics Engine/graphql/"},"next":{"title":"Use cases","permalink":"/academy/MasteryTrack/WorkWithData/Analytics Engine/use-cases/"}}');var a=r(5723),s=r(7474);const o={sidebar_position:1},i="Integration",l={},c=[{value:"Resolvers and types",id:"resolvers-and-types",level:2},{value:"Apollo 4",id:"apollo-4",level:3}];function p(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"integration",children:"Integration"})}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"analytics-engine-graphql"})," module provides types and resolvers needed for a fully-functional GraphQL Server API. This library has no dependencies on any particular server but has been tested using ",(0,a.jsx)(n.a,{href:"https://www.apollographql.com/docs/apollo-server",children:"Apollo Server 3 and 4"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"resolvers-and-types",children:"Resolvers and types"}),"\n",(0,a.jsxs)(n.p,{children:["The graphql package contains typical resolvers and typedefs. The resolvers, however, are dependent on another object: ",(0,a.jsx)(n.code,{children:"AnalyticsModel"}),". This object is responsible for connecting GQL types with an ",(0,a.jsx)(n.code,{children:"IAnalyticsStore"})," implementation."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'import {\n  AnalyticsModel,\n  AnalyticsResolvers,\n  typedefs,\n} from "@powerhousedao/analytics-engine-graphql";\nimport { AnalyticsQueryEngine } from "@powerhousedao/analytics-engine-core";\nimport { MemoryAnalyticsStore } from "@powerhousedao/analytics-engine-browser";\n\nconst model = new AnalyticsModel(\n  new AnalyticsQueryEngine(new MemoryAnalyticsStore()),\n);\n'})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:["Note that the analytics resolvers require the passed in context to have an ",(0,a.jsx)(n.code,{children:"AnalyticsModel"})," implementation on it. See below for details."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"apollo-4",children:"Apollo 4"}),"\n",(0,a.jsxs)(n.p,{children:["A minimal Apollo 4 example is noted below for completeness, but a full working example can be found in the ",(0,a.jsx)(n.a,{href:"https://github.com/makerdao-ses/ecosystem-api/",children:"MakerDAO-SES Ecosystem API repo"}),". Note, in particular, that we pass along a specific context in the Apollo express middleware."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'import express from "express";\nimport http from "http";\n\nimport { makeExecutableSchema } from "@graphql-tools/schema";\nimport { ApolloServer } from "@apollo/server";\nimport { expressMiddleware } from "@apollo/server/express4";\nimport { ApolloServerPluginDrainHttpServer } from "@apollo/server/plugin/drainHttpServer";\n\nimport {\n  AnalyticsModel,\n  AnalyticsResolvers,\n  typedefs,\n} from "@powerhousedao/analytics-engine-graphql";\nimport { AnalyticsQueryEngine } from "@powerhousedao/analytics-engine-core";\nimport { MemoryAnalyticsStore } from "@powerhousedao/analytics-engine-browser";\n\n// create a typical http service\nconst app = express();\nconst httpServer = http.createServer(app);\n\n// create analytics gql schema from typedefs + resolvers\nconst schema = makeExecutableSchema({\n  typeDefs: typedefs,\n  resolvers: AnalyticsResolvers,\n});\n\n// create an apollo instance\nconst plugins = [\n  ApolloServerPluginDrainHttpServer({ httpServer }),\n  responseCachePlugin(),\n];\nconst server = new ApolloServer({\n  schema,\n  plugins,\n});\n\nawait server.start();\n\n// needed by the analytics resolvers\nconst model = new AnalyticsModel(\n  new AnalyticsQueryEngine(new MemoryAnalyticsStore()),\n);\n\napp.use(\n  "/graphql",\n  express.json(),\n  expressMiddleware(server, {\n    context: ({ req }) => {\n      // the analytics resolvers expect this on the context\n      return {\n        dataSources: { db: { Analytics: model } },\n      };\n    },\n  }),\n);\n\nawait new Promise<void>((resolve) => httpServer.listen(options, resolve));\n'})})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},7474:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>i});var t=r(2155);const a={},s=t.createContext(a);function o(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);