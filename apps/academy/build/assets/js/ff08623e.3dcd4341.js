"use strict";(self.webpackChunk_powerhousedao_academy=self.webpackChunk_powerhousedao_academy||[]).push([[1891],{4191:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"academy/APIReferences/RelationalDatabase","title":"Relational Database","description":"This page covers the relational database tools available in Powerhouse applications, providing type-safe database operations with real-time updates through PGlite integration.","source":"@site/docs/academy/04-APIReferences/04-RelationalDatabase.md","sourceDirName":"academy/04-APIReferences","slug":"/academy/APIReferences/RelationalDatabase","permalink":"/academy/APIReferences/RelationalDatabase","draft":false,"unlisted":false,"editUrl":"https://github.com/powerhouse-inc/powerhouse-docs/tree/dev/docs/academy/04-APIReferences/04-RelationalDatabase.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{},"sidebar":"academySidebar","previous":{"title":"React Hooks","permalink":"/academy/APIReferences/ReactHooks"},"next":{"title":"PHDocument Migration Guide","permalink":"/academy/APIReferences/PHDocumentMigrationGuide"}}');var a=r(5723),t=r(7474);const i={},o="Relational Database",l={},d=[{value:"Overview",id:"overview",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"Step 1: Define your database schema",id:"step-1-define-your-database-schema",level:3},{value:"Step 2: Create a typed query hook",id:"step-2-create-a-typed-query-hook",level:3},{value:"Step 3: Use it in your component",id:"step-3-use-it-in-your-component",level:3},{value:"Step 4: Use in your React component",id:"step-4-use-in-your-react-component",level:3},{value:"Core Hooks",id:"core-hooks",level:2},{value:"1. createProcessorQuery()",id:"1-createprocessorquery",level:3},{value:"Function Name and Signature",id:"function-name-and-signature",level:3},{value:"Description",id:"description",level:3},{value:"Usage Example",id:"usage-example",level:3},{value:"Parameters",id:"parameters",level:3},{value:"Return Value",id:"return-value",level:3},{value:"Notes / Caveats",id:"notes--caveats",level:3},{value:"2. useRelationalDb()",id:"2-userelationaldb",level:3},{value:"Hook Name and Signature",id:"hook-name-and-signature",level:3},{value:"Description",id:"description-1",level:3},{value:"Usage Example",id:"usage-example-1",level:3},{value:"Parameters",id:"parameters-1",level:3},{value:"Return Value",id:"return-value-1",level:3},{value:"Notes / Caveats",id:"notes--caveats-1",level:3},{value:"Related Hooks",id:"related-hooks",level:3},{value:"3. useRelationalQuery()",id:"3-userelationalquery",level:3},{value:"Hook Name and Signature",id:"hook-name-and-signature-1",level:3},{value:"Description",id:"description-2",level:3},{value:"Usage Example",id:"usage-example-2",level:3},{value:"Parameters",id:"parameters-2",level:3},{value:"Return Value",id:"return-value-2",level:3},{value:"Notes / Caveats",id:"notes--caveats-2",level:3},{value:"Related Hooks",id:"related-hooks-1",level:3},{value:"Advanced Patterns",id:"advanced-patterns",level:2},{value:"Working with Dynamic Parameters",id:"working-with-dynamic-parameters",level:3},{value:"Problem",id:"problem",level:3},{value:"Solution",id:"solution",level:3},{value:"Key Points",id:"key-points",level:3},{value:"Custom SQL Queries",id:"custom-sql-queries",level:3},{value:"Problem",id:"problem-1",level:3},{value:"Solution",id:"solution-1",level:3},{value:"Key Points",id:"key-points-1",level:3},{value:"Complex Joins and Relationships",id:"complex-joins-and-relationships",level:3},{value:"Problem",id:"problem-2",level:3},{value:"Solution",id:"solution-2",level:3},{value:"Key Points",id:"key-points-2",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Schema Definition",id:"1-schema-definition",level:3},{value:"2. Hook Organization",id:"2-hook-organization",level:3},{value:"3. Error Handling",id:"3-error-handling",level:3},{value:"4. Performance Optimization",id:"4-performance-optimization",level:3},{value:"Common Issues and Solutions",id:"common-issues-and-solutions",level:2},{value:"Query Not Updating",id:"query-not-updating",level:3},{value:"Problem",id:"problem-3",level:3},{value:"Solution",id:"solution-3",level:3},{value:"Debugging Tips",id:"debugging-tips",level:3},{value:"Type Errors",id:"type-errors",level:3},{value:"Problem",id:"problem-4",level:3},{value:"Solution",id:"solution-4",level:3},{value:"Performance Issues",id:"performance-issues",level:3},{value:"Problem",id:"problem-5",level:3},{value:"Solution",id:"solution-5",level:3},{value:"Further Reading",id:"further-reading",level:2},{value:"Related Hooks",id:"related-hooks-2",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components},{Details:r}=n;return r||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"relational-database",children:"Relational Database"})}),"\n",(0,a.jsx)(n.p,{children:"This page covers the relational database tools available in Powerhouse applications, providing type-safe database operations with real-time updates through PGlite integration."}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(n.p,{children:"The relational database layer gives you powerful tools to work with data in your Powerhouse applications. You get type-safe queries, real-time updates, and a simple API that feels familiar to React developers."}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Key Benefits:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Type-safe queries"})," with full TypeScript support"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Live query capabilities"})," with real-time updates"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Automatic optimization"})," to prevent infinite re-renders"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Simple API"})," that abstracts away complexity"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Smart memorization"})," for parameters and queries"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsx)("summary",{children:"Setting up your first relational database query"}),(0,a.jsx)(n.h3,{id:"step-1-define-your-database-schema",children:"Step 1: Define your database schema"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"type MyDatabase = {\n  users: {\n    id: number;\n    name: string;\n    email: string;\n  };\n  posts: {\n    id: number;\n    title: string;\n    content: string;\n    author_id: number;\n  };\n};\n"})}),(0,a.jsx)(n.h3,{id:"step-2-create-a-typed-query-hook",children:"Step 2: Create a typed query hook"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'import { createProcessorQuery } from "@powerhousedao/reactor-browser/relational";\nimport { MyProcessor } from "./processors/my-processor";\n\n// Create a typed query hook for your processor\nconst useTypedQuery = createProcessorQuery(MyProcessor);\n'})}),(0,a.jsx)(n.h3,{id:"step-3-use-it-in-your-component",children:"Step 3: Use it in your component"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'// Simple query - no parameters needed\nexport function useUserList(driveId: string) {\n  return useTypedQuery(driveId, (db) => {\n    return db.selectFrom("users").selectAll().compile();\n  });\n}\n\n// Query with parameters\nexport function useUserById(driveId: string, userId: number) {\n  return useTypedQuery(\n    driveId,\n    (db, params) => {\n      return db\n        .selectFrom("users")\n        .selectAll()\n        .where("id", "=", params.userId)\n        .compile();\n    },\n    { userId },\n  );\n}\n'})}),(0,a.jsx)(n.h3,{id:"step-4-use-in-your-react-component",children:"Step 4: Use in your React component"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"function UserList({ driveId }: { driveId: string }) {\n  const { isLoading, error, result } = useUserList(driveId);\n\n  if (isLoading) return <div>Loading...</div>;\n  if (error) return <div>Error: {error.message}</div>;\n  if (!result) return <div>No data</div>;\n\n  return (\n    <ul>\n      {result.rows.map(user => (\n        <li key={user.id}>\n          {user.name} - {user.email}\n        </li>\n      ))}\n    </ul>\n  );\n}\n"})})]}),"\n",(0,a.jsx)(n.h2,{id:"core-hooks",children:"Core Hooks"}),"\n",(0,a.jsx)(n.h3,{id:"1-createprocessorquery",children:"1. createProcessorQuery()"}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsxs)("summary",{children:[(0,a.jsx)(n.code,{children:"createProcessorQuery(ProcessorClass)"}),": Creates a typed query hook factory for your processor"]}),(0,a.jsx)(n.h3,{id:"function-name-and-signature",children:"Function Name and Signature"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"function createProcessorQuery<Schema>(\n  ProcessorClass: RelationalDbProcessorClass<Schema>,\n): TypedQueryHook<Schema>;\n"})}),(0,a.jsx)(n.h3,{id:"description",children:"Description"}),(0,a.jsx)(n.p,{children:"Creates a typed query hook factory for a specific processor class. This is the main function you'll use to create hooks for querying your relational database."}),(0,a.jsx)(n.h3,{id:"usage-example",children:"Usage Example"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'import { createProcessorQuery } from "@powerhousedao/reactor-browser/relational";\nimport { MyProcessor } from "./processors/my-processor";\n\n// Create a typed query hook for your processor\nconst useTypedQuery = createProcessorQuery(MyProcessor);\n\n// Use it to create specific query hooks\nexport const useUsers = (driveId: string) => {\n  return useTypedQuery(driveId, (db) => {\n    return db.selectFrom("users").selectAll().compile();\n  });\n};\n\n// With parameters\nexport const useUsersByStatus = (driveId: string, status: string) => {\n  return useTypedQuery(\n    driveId,\n    (db, params) => {\n      return db\n        .selectFrom("users")\n        .selectAll()\n        .where("status", "=", params.status)\n        .compile();\n    },\n    { status },\n  );\n};\n'})}),(0,a.jsx)(n.h3,{id:"parameters",children:"Parameters"}),(0,a.jsx)(n.p,{children:"The returned hook accepts:"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"driveId"}),": The ID of the drive"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"queryCallback"}),": Function that receives the database instance and optional parameters"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"parameters"}),": Optional parameters for the query"]}),"\n"]}),(0,a.jsx)(n.h3,{id:"return-value",children:"Return Value"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"{\n  isLoading: boolean; // True while loading or retrying\n  error: Error | null; // Any error that occurred\n  result: LiveQueryResults<T> | null; // Query results with live updates\n}\n"})}),(0,a.jsx)(n.h3,{id:"notes--caveats",children:"Notes / Caveats"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Create one ",(0,a.jsx)(n.code,{children:"useTypedQuery"})," hook per processor"]}),"\n",(0,a.jsx)(n.li,{children:"The hook includes automatic retry logic for common errors"}),"\n",(0,a.jsx)(n.li,{children:"Parameters are automatically memoized"}),"\n",(0,a.jsx)(n.li,{children:"Queries are live and will update automatically when data changes"}),"\n"]})]}),"\n",(0,a.jsx)(n.h3,{id:"2-userelationaldb",children:"2. useRelationalDb()"}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsxs)("summary",{children:[(0,a.jsx)(n.code,{children:"useRelationalDb<Schema>()"}),": Access the enhanced database instance directly"]}),(0,a.jsx)(n.h3,{id:"hook-name-and-signature",children:"Hook Name and Signature"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"function useRelationalDb<Schema>(): IRelationalDb<Schema>;\n"})}),(0,a.jsx)(n.h3,{id:"description-1",children:"Description"}),(0,a.jsx)(n.p,{children:"Provides direct access to the enhanced Kysely database instance with live query capabilities. Use this when you need to perform relational database operations outside of the typical query patterns."}),(0,a.jsx)(n.h3,{id:"usage-example-1",children:"Usage Example"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"import { useRelationalDb } from '@powerhousedao/reactor-browser/relational';\n\nfunction DatabaseOperations() {\n  const { db, isLoading, error } = useRelationalDb<MyDatabase>();\n\n  const createUser = async (name: string, email: string) => {\n    if (!db) return;\n\n    // Direct database operations\n    await db\n      .insertInto('users')\n      .values({ name, email })\n      .execute();\n  };\n\n  if (isLoading) return <div>Database initializing...</div>;\n  if (error) return <div>Database error: {error.message}</div>;\n\n  return (\n    <button onClick={() => createUser('John', 'john@example.com')}>\n      Create User\n    </button>\n  );\n}\n"})}),(0,a.jsx)(n.h3,{id:"parameters-1",children:"Parameters"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"Schema"})," - TypeScript type defining your database schema"]}),"\n"]}),(0,a.jsx)(n.h3,{id:"return-value-1",children:"Return Value"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"{\n  db: EnhancedKysely<Schema> | null; // Enhanced Kysely instance with live capabilities\n  isLoading: boolean; // True while database is initializing\n  error: Error | null; // Any initialization error\n}\n"})}),(0,a.jsx)(n.h3,{id:"notes--caveats-1",children:"Notes / Caveats"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Always check if ",(0,a.jsx)(n.code,{children:"db"})," is not null before using it"]}),"\n",(0,a.jsx)(n.li,{children:"The database instance includes both Kysely methods and live query capabilities"}),"\n",(0,a.jsx)(n.li,{children:"Use this for direct database operations like inserts, updates, and deletes"}),"\n",(0,a.jsxs)(n.li,{children:["For queries, prefer ",(0,a.jsx)(n.code,{children:"createProcessorQuery()"})," which provides better optimization"]}),"\n"]}),(0,a.jsx)(n.h3,{id:"related-hooks",children:"Related Hooks"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"#1-createprocessorquery",children:(0,a.jsx)(n.code,{children:"createProcessorQuery"})})," - For optimized queries"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"#3-userelationalquery",children:(0,a.jsx)(n.code,{children:"useRelationalQuery"})})," - For manual query control"]}),"\n"]})]}),"\n",(0,a.jsx)(n.h3,{id:"3-userelationalquery",children:"3. useRelationalQuery()"}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsxs)("summary",{children:[(0,a.jsx)(n.code,{children:"useRelationalQuery<Schema, T, TParams>()"}),": Lower-level hook for manual query control"]}),(0,a.jsx)(n.h3,{id:"hook-name-and-signature-1",children:"Hook Name and Signature"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"function useRelationalQuery<Schema, T, TParams>(\n  queryCallback: (\n    db: EnhancedKysely<Schema>,\n    parameters?: TParams,\n  ) => QueryCallbackReturnType,\n  parameters?: TParams,\n): QueryResult<T>;\n"})}),(0,a.jsx)(n.h3,{id:"description-2",children:"Description"}),(0,a.jsxs)(n.p,{children:["Lower-level hook for creating live queries with manual control over the query callback and parameters. Most developers should use ",(0,a.jsx)(n.code,{children:"createProcessorQuery()"})," instead, but this hook is useful for advanced use cases."]}),(0,a.jsx)(n.h3,{id:"usage-example-2",children:"Usage Example"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"import { useRelationalQuery } from '@powerhousedao/reactor-browser/relational';\n\nfunction UserCount() {\n  const { result, isLoading, error } = useRelationalQuery<MyDatabase, { count: number }>(\n    (db) => {\n      return db\n        .selectFrom('users')\n        .select(db.fn.count('id').as('count'))\n        .compile();\n    }\n  );\n\n  if (isLoading) return <div>Loading...</div>;\n  if (error) return <div>Error: {error.message}</div>;\n\n  return <div>User count: {result?.rows[0]?.count ?? 0}</div>;\n}\n"})}),(0,a.jsx)(n.h3,{id:"parameters-2",children:"Parameters"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"queryCallback"})," - Function that receives the database instance and optional parameters"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"parameters"})," - Optional parameters for the query"]}),"\n"]}),(0,a.jsx)(n.h3,{id:"return-value-2",children:"Return Value"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"{\n  result: LiveQueryResults<T> | null; // Live query results\n  isLoading: boolean; // Combined loading state\n  error: Error | null; // Any error that occurred\n}\n"})}),(0,a.jsx)(n.h3,{id:"notes--caveats-2",children:"Notes / Caveats"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"This hook doesn't include automatic parameter memoization"}),"\n",(0,a.jsxs)(n.li,{children:["Use ",(0,a.jsx)(n.code,{children:"createProcessorQuery()"})," for better developer experience and optimization"]}),"\n",(0,a.jsx)(n.li,{children:"Useful for cases where you need manual control over the query lifecycle"}),"\n"]}),(0,a.jsx)(n.h3,{id:"related-hooks-1",children:"Related Hooks"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"#1-createprocessorquery",children:(0,a.jsx)(n.code,{children:"createProcessorQuery"})})," - Recommended higher-level API"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"#2-usedelationaldb",children:(0,a.jsx)(n.code,{children:"useRelationalDb"})})," - For direct database access"]}),"\n"]})]}),"\n",(0,a.jsx)(n.h2,{id:"advanced-patterns",children:"Advanced Patterns"}),"\n",(0,a.jsx)(n.h3,{id:"working-with-dynamic-parameters",children:"Working with Dynamic Parameters"}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsx)("summary",{children:"How to handle parameters that change over time"}),(0,a.jsx)(n.h3,{id:"problem",children:"Problem"}),(0,a.jsx)(n.p,{children:"You need to create queries that update automatically when search terms, filters, or other parameters change."}),(0,a.jsx)(n.h3,{id:"solution",children:"Solution"}),(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"createProcessorQuery"})," hook automatically handles parameter changes and memoizes them using deep comparison:"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'function useSearchResults() {\n  const [searchTerm, setSearchTerm] = useState("");\n  const [category, setCategory] = useState("all");\n\n  // Query automatically updates when searchTerm or category changes\n  const result = useTypedQuery(\n    (db, params) => {\n      let query = db.selectFrom("products").selectAll();\n\n      if (params.searchTerm) {\n        query = query.where("name", "like", `%${params.searchTerm}%`);\n      }\n\n      if (params.category !== "all") {\n        query = query.where("category", "=", params.category);\n      }\n\n      return query.compile();\n    },\n    { searchTerm, category },\n  );\n\n  return { result, setSearchTerm, setCategory };\n}\n'})}),(0,a.jsx)(n.h3,{id:"key-points",children:"Key Points"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Parameters are automatically memoized using deep comparison"}),"\n",(0,a.jsxs)(n.li,{children:["No need to wrap parameters in ",(0,a.jsx)(n.code,{children:"useMemo"})]}),"\n",(0,a.jsx)(n.li,{children:"Query re-runs only when parameter values actually change"}),"\n",(0,a.jsx)(n.li,{children:"Works with complex nested objects"}),"\n"]})]}),"\n",(0,a.jsx)(n.h3,{id:"custom-sql-queries",children:"Custom SQL Queries"}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsx)("summary",{children:"Using raw SQL instead of Kysely query builder"}),(0,a.jsx)(n.h3,{id:"problem-1",children:"Problem"}),(0,a.jsx)(n.p,{children:"You need to write complex SQL queries that are easier to express in raw SQL than using the Kysely query builder."}),(0,a.jsx)(n.h3,{id:"solution-1",children:"Solution"}),(0,a.jsx)(n.p,{children:"You can return raw SQL queries from your callback:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"function useCustomUserStats() {\n  return useTypedQuery(() => {\n    return {\n      sql: `\n        SELECT \n          u.name, \n          COUNT(p.id) as post_count,\n          MAX(p.created_at) as last_post_date\n        FROM users u \n        LEFT JOIN posts p ON u.id = p.author_id \n        GROUP BY u.id, u.name\n        ORDER BY post_count DESC\n      `,\n    };\n  });\n}\n\n// With parameters\nfunction useUserPostsByDateRange(startDate: string, endDate: string) {\n  return useTypedQuery(\n    (db, params) => {\n      return {\n        sql: `\n          SELECT p.*, u.name as author_name\n          FROM posts p\n          JOIN users u ON p.author_id = u.id\n          WHERE p.created_at BETWEEN $1 AND $2\n          ORDER BY p.created_at DESC\n        `,\n        parameters: [params.startDate, params.endDate],\n      };\n    },\n    { startDate, endDate },\n  );\n}\n"})}),(0,a.jsx)(n.h3,{id:"key-points-1",children:"Key Points"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Return an object with ",(0,a.jsx)(n.code,{children:"sql"})," and optional ",(0,a.jsx)(n.code,{children:"parameters"})," properties"]}),"\n",(0,a.jsx)(n.li,{children:"Use parameterized queries ($1, $2, etc.) for dynamic values"}),"\n",(0,a.jsx)(n.li,{children:"You can mix Kysely and raw SQL approaches in the same application"}),"\n"]})]}),"\n",(0,a.jsx)(n.h3,{id:"complex-joins-and-relationships",children:"Complex Joins and Relationships"}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsx)("summary",{children:"Working with related data across multiple tables"}),(0,a.jsx)(n.h3,{id:"problem-2",children:"Problem"}),(0,a.jsx)(n.p,{children:"You need to fetch related data from multiple tables with complex relationships."}),(0,a.jsx)(n.h3,{id:"solution-2",children:"Solution"}),(0,a.jsx)(n.p,{children:"Use Kysely's join capabilities within your query callbacks:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'function useUsersWithPosts() {\n  return useTypedQuery((db) => {\n    return db\n      .selectFrom("users")\n      .leftJoin("posts", "users.id", "posts.author_id")\n      .select([\n        "users.id",\n        "users.name",\n        "users.email",\n        "posts.title as post_title",\n        "posts.content as post_content",\n      ])\n      .compile();\n  });\n}\n\n// More complex example with multiple joins and aggregations\nfunction useUserDashboardData(userId: number) {\n  return useTypedQuery(\n    (db, params) => {\n      return db\n        .selectFrom("users")\n        .leftJoin("posts", "users.id", "posts.author_id")\n        .leftJoin("comments", "posts.id", "comments.post_id")\n        .select([\n          "users.id",\n          "users.name",\n          "users.email",\n          db.fn.count("posts.id").as("post_count"),\n          db.fn.count("comments.id").as("comment_count"),\n        ])\n        .where("users.id", "=", params.userId)\n        .groupBy(["users.id", "users.name", "users.email"])\n        .compile();\n    },\n    { userId },\n  );\n}\n'})}),(0,a.jsx)(n.h3,{id:"key-points-2",children:"Key Points"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Use Kysely's join methods for related data"}),"\n",(0,a.jsx)(n.li,{children:"Leverage aggregation functions for counts and calculations"}),"\n",(0,a.jsx)(n.li,{children:"Type safety is maintained throughout complex queries"}),"\n"]})]}),"\n",(0,a.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,a.jsx)(n.h3,{id:"1-schema-definition",children:"1. Schema Definition"}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsx)("summary",{children:"How to properly define your database schema types"}),(0,a.jsx)(n.p,{children:"Always define clear TypeScript interfaces for your database schema:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"// \u2705 Good - Clear, typed schema\ntype AppDatabase = {\n  users: {\n    id: number;\n    name: string;\n    email: string;\n    created_at: Date;\n    updated_at: Date;\n  };\n  posts: {\n    id: number;\n    title: string;\n    content: string;\n    author_id: number;\n    published: boolean;\n    created_at: Date;\n  };\n};\n\n// \u274c Avoid - Vague or missing types\ntype BadDatabase = {\n  users: any;\n  posts: Record<string, unknown>;\n};\n"})})]}),"\n",(0,a.jsx)(n.h3,{id:"2-hook-organization",children:"2. Hook Organization"}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsx)("summary",{children:"How to organize your database hooks"}),(0,a.jsx)(n.p,{children:"Create focused, reusable hooks for different data access patterns:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'// \u2705 Good - Focused, reusable hooks\nexport function useUsers() {\n  return useTypedQuery((db) => db.selectFrom("users").selectAll().compile());\n}\n\nexport function useUserById(id: number) {\n  return useTypedQuery(\n    (db, params) =>\n      db.selectFrom("users").selectAll().where("id", "=", params.id).compile(),\n    { id },\n  );\n}\n\nexport function useActiveUsers() {\n  return useTypedQuery((db) =>\n    db.selectFrom("users").selectAll().where("active", "=", true).compile(),\n  );\n}\n\n// \u274c Avoid - Too generic or complex\nexport function useEverything() {\n  return useTypedQuery((db) =>\n    db\n      .selectFrom("users")\n      .leftJoin("posts", "users.id", "posts.author_id")\n      .leftJoin("comments", "posts.id", "comments.post_id")\n      .selectAll() // Too much data\n      .compile(),\n  );\n}\n'})})]}),"\n",(0,a.jsx)(n.h3,{id:"3-error-handling",children:"3. Error Handling"}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsx)("summary",{children:"How to handle loading states and errors"}),(0,a.jsx)(n.p,{children:"Always handle loading and error states in your components:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"function UserList() {\n  const { isLoading, error, result } = useUsers();\n\n  // \u2705 Good - Handle all states\n  if (isLoading) return <LoadingSpinner />;\n  if (error) return <ErrorMessage error={error} />;\n  if (!result) return <NoDataMessage />;\n\n  return (\n    <ul>\n      {result.rows.map(user => (\n        <li key={user.id}>{user.name}</li>\n      ))}\n    </ul>\n  );\n}\n\n// \u274c Avoid - Missing error handling\nfunction BadUserList() {\n  const { result } = useUsers();\n\n  return (\n    <ul>\n      {result?.rows.map(user => (\n        <li key={user.id}>{user.name}</li>\n      ))}\n    </ul>\n  );\n}\n"})})]}),"\n",(0,a.jsx)(n.h3,{id:"4-performance-optimization",children:"4. Performance Optimization"}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsx)("summary",{children:"Tips for optimal query performance"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Keep queries focused"}),": Don't select unnecessary columns or join too many tables"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use parameters wisely"}),": The automatic memoization handles most cases, but avoid creating new objects unnecessarily"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Consider query frequency"}),": For data that changes rarely, consider caching strategies"]}),"\n"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'// \u2705 Good - Focused query\nfunction useUserNames() {\n  return useTypedQuery((db) =>\n    db\n      .selectFrom("users")\n      .select(["id", "name"]) // Only what you need\n      .compile(),\n  );\n}\n\n// \u2705 Good - Stable parameters\nfunction useUsersByStatus(status: string) {\n  return useTypedQuery(\n    (db, params) =>\n      db\n        .selectFrom("users")\n        .selectAll()\n        .where("status", "=", params.status)\n        .compile(),\n    { status }, // Simple, stable parameter\n  );\n}\n\n// \u274c Avoid - Unnecessary data\nfunction useEverythingAboutUsers() {\n  return useTypedQuery((db) =>\n    db\n      .selectFrom("users")\n      .leftJoin("posts", "users.id", "posts.author_id")\n      .selectAll() // Too much data\n      .compile(),\n  );\n}\n'})})]}),"\n",(0,a.jsx)(n.h2,{id:"common-issues-and-solutions",children:"Common Issues and Solutions"}),"\n",(0,a.jsx)(n.h3,{id:"query-not-updating",children:"Query Not Updating"}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsx)("summary",{children:"My query results aren't updating when I expect them to"}),(0,a.jsx)(n.h3,{id:"problem-3",children:"Problem"}),(0,a.jsx)(n.p,{children:"Your query results don't update when you expect them to, even though you've changed parameters."}),(0,a.jsx)(n.h3,{id:"solution-3",children:"Solution"}),(0,a.jsx)(n.p,{children:"Check that your parameters are actually changing in content, not just reference:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"// \u2705 Good - Parameters change in content\nconst [userId, setUserId] = useState(1);\nconst result = useUserById(userId); // Updates when userId changes\n\n// \u274c Common mistake - Same content, different objects\nconst result = useTypedQuery(\n  (db, params) => /* query */,\n  { userId: user.id } // New object every render, but same content\n);\n\n// \u2705 Better - Extract stable values\nconst userId = user.id;\nconst result = useTypedQuery(\n  (db, params) => /* query */,\n  { userId } // Stable parameter\n);\n"})}),(0,a.jsx)(n.h3,{id:"debugging-tips",children:"Debugging Tips"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Log your parameters to see if they're actually changing"}),"\n",(0,a.jsxs)(n.li,{children:["Check the ",(0,a.jsx)(n.code,{children:"isLoading"})," state to see if queries are re-running"]}),"\n",(0,a.jsx)(n.li,{children:"Use React DevTools to inspect hook state changes"}),"\n"]})]}),"\n",(0,a.jsx)(n.h3,{id:"type-errors",children:"Type Errors"}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsx)("summary",{children:"Getting TypeScript errors with my queries"}),(0,a.jsx)(n.h3,{id:"problem-4",children:"Problem"}),(0,a.jsx)(n.p,{children:"TypeScript is showing errors about query return types or database schema."}),(0,a.jsx)(n.h3,{id:"solution-4",children:"Solution"}),(0,a.jsx)(n.p,{children:"Make sure your callback returns the correct type:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'// \u2705 Good - Returns QueryCallbackReturnType\nconst result = useTypedQuery((db) => {\n  return db.selectFrom("users").selectAll().compile(); // Has sql property\n});\n\n// \u274c Error - Missing .compile()\nconst result = useTypedQuery((db) => {\n  return db.selectFrom("users").selectAll(); // No sql property\n});\n\n// \u2705 Good - Raw SQL format\nconst result = useTypedQuery(() => {\n  return {\n    sql: "SELECT * FROM users",\n    parameters: [],\n  };\n});\n'})})]}),"\n",(0,a.jsx)(n.h3,{id:"performance-issues",children:"Performance Issues"}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsx)("summary",{children:"My queries are running too frequently or causing lag"}),(0,a.jsx)(n.h3,{id:"problem-5",children:"Problem"}),(0,a.jsx)(n.p,{children:"Your queries are running more often than expected, causing performance issues."}),(0,a.jsx)(n.h3,{id:"solution-5",children:"Solution"}),(0,a.jsx)(n.p,{children:"Check for unstable parameters or overly complex queries:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"// \u274c Problem - New object every render\nfunction BadComponent({ user }) {\n  const result = useTypedQuery(\n    (db, params) => /* query */,\n    {\n      filter: { status: 'active', dept: user.department } // New object each render\n    }\n  );\n}\n\n// \u2705 Solution - Stable parameters\nfunction GoodComponent({ user }) {\n  const filter = useMemo(() => ({\n    status: 'active',\n    dept: user.department\n  }), [user.department]);\n\n  const result = useTypedQuery(\n    (db, params) => /* query */,\n    { filter }\n  );\n}\n\n// \u2705 Even better - Direct values\nfunction BetterComponent({ user }) {\n  const result = useTypedQuery(\n    (db, params) => /* query */,\n    {\n      status: 'active',\n      dept: user.department\n    }\n  );\n}\n"})})]}),"\n",(0,a.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"https://kysely.dev/",children:"Kysely Documentation"})," - Learn more about the query builder"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"https://pglite.dev/",children:"PGlite Documentation"})," - Understanding the underlying database"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/academy/APIReferences/ReactHooks",children:"React Hooks"})," - Other available hooks in Powerhouse"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/academy/ComponentLibrary/DocumentEngineering",children:"Component Library"})," - Building UI components"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"related-hooks-2",children:"Related Hooks"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/academy/APIReferences/ReactHooks#usedocuments",children:(0,a.jsx)(n.code,{children:"useDocuments"})})," - Working with Powerhouse documents"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/academy/APIReferences/ReactHooks#usedrives",children:(0,a.jsx)(n.code,{children:"useDrives"})})," - Managing document drives"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/academy/APIReferences/ReactHooks#useselecteddocument",children:(0,a.jsx)(n.code,{children:"useSelectedDocument"})})," - Document selection state"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},7474:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>o});var s=r(2155);const a={},t=s.createContext(a);function i(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);