"use strict";(self.webpackChunk_powerhousedao_academy=self.webpackChunk_powerhousedao_academy||[]).push([[3717],{261:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"academy/MasteryTrack/WorkWithData/Analytics Engine/typescript/memory","title":"Memory store","description":"The MemoryAnalyticsStore is an IAnalyticsStore implementation that uses a an in-memory database as its storage mechanism. Under the hood, we load a WASM build of Postgres, called PGlite.","source":"@site/docs/academy/02-MasteryTrack/04-WorkWithData/06-Analytics Engine/typescript/memory.md","sourceDirName":"academy/02-MasteryTrack/04-WorkWithData/06-Analytics Engine/typescript","slug":"/academy/MasteryTrack/WorkWithData/Analytics Engine/typescript/memory","permalink":"/academy/MasteryTrack/WorkWithData/Analytics Engine/typescript/memory","draft":false,"unlisted":false,"editUrl":"https://github.com/powerhouse-inc/powerhouse-docs/tree/dev/docs/academy/02-MasteryTrack/04-WorkWithData/06-Analytics Engine/typescript/memory.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"academySidebar","previous":{"title":"Typescript API","permalink":"/academy/MasteryTrack/WorkWithData/Analytics Engine/typescript/"},"next":{"title":"Browser store","permalink":"/academy/MasteryTrack/WorkWithData/Analytics Engine/typescript/browser"}}');var i=n(5723),r=n(7474);const a={sidebar_position:1},o="Memory store",c={},l=[{value:"Construction",id:"construction",level:2},{value:"Initialization",id:"initialization",level:2}];function d(e){const t={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"memory-store",children:"Memory store"})}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"MemoryAnalyticsStore"})," is an ",(0,i.jsx)(t.code,{children:"IAnalyticsStore"})," implementation that uses a an in-memory database as its storage mechanism. Under the hood, we load a WASM build of Postgres, called ",(0,i.jsx)(t.a,{href:"https://pglite.dev/",children:"PGlite"}),"."]}),"\n",(0,i.jsx)("aside",{class:"notice",children:(0,i.jsxs)(t.p,{children:["See the ",(0,i.jsx)("a",{href:"#compatibility",children:"Compatibility"})," section for details on which stores are intended to be used in different execution environments."]})}),"\n",(0,i.jsx)(t.h2,{id:"construction",children:"Construction"}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"MemoryAnalyticsStore"})," is simple to create."]}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.p,{children:"Create with no arguments."}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"const store = new MemoryAnalyticsStore();\n"})}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"MemoryAnalyticsStore"})," may also be created with optional contructor arguments that may be helpful for debugging or metrics collection."]}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:'const store = new MemoryAnalyticsStore({\n  queryLogger: querydefaultQueryLogger("memory"),\n  resultsLogger: defaultResultsLogger("memory"),\n  profiler: new PassthroughAnalyticsProfiler(),\n});\n'})}),"\n",(0,i.jsxs)(t.p,{children:["For more details on these optional constructor parameters, see the ",(0,i.jsx)(t.a,{href:"#utilities",children:"Utilities"})," section."]}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsxs)(t.p,{children:["Additionally, both ",(0,i.jsx)(t.code,{children:"knex"})," and ",(0,i.jsx)(t.code,{children:"pglite"})," objects may be passed in. This is helpful in contexts where multiple objects are sharing the same database."]}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:'// knex must be created with these options\nconst knex = knexFactory({ client: "pg", useNullAsDefault: true });\n\n// create your own Pglite instance and pass it in\n// See (https://github.com/electric-sql/pglite/blob/main/packages/pglite/src/interface.ts) for full list of options.\nconst pgLiteFactory = () =>\n  PGlite.create({\n    debug: 3,\n    relaxedDurability: false,\n  });\n\nconst store = new MemoryAnalyticsStore({\n  knex,\n  pgLiteFactory,\n});\n'})}),"\n",(0,i.jsx)(t.h2,{id:"initialization",children:"Initialization"}),"\n",(0,i.jsxs)(t.p,{children:["While easy to use, the ",(0,i.jsx)(t.code,{children:"MemoryAnalyticsStore"})," requires an asynchronous initialization step. This is for two reasons."]}),"\n",(0,i.jsxs)(t.p,{children:["In cases where the ",(0,i.jsx)(t.code,{children:"MemoryAnalyticsStore"})," was not provided a ",(0,i.jsx)(t.code,{children:"PGlite"})," instance, it needs time to download and initialize the WASM build."]}),"\n",(0,i.jsxs)(t.p,{children:["Additionally, it also needs to initialize the database schema of the in-memory database. This is distinct from the ",(0,i.jsx)("a",{href:"#postgres",children:"Postgres implementation"}),", which assumes a fully-initialized Postgres database already exists. The initialization is idempotent, so tables already created will not be recreated."]}),"\n",(0,i.jsxs)(t.p,{children:["The full SQL query used can be found in the ",(0,i.jsxs)(t.a,{href:"https://github.com/powerhouse-inc/analytics-engine/blob/main/browser/src/MemoryAnalyticsStore.ts",children:[(0,i.jsx)(t.code,{children:"MemoryAnalyticsStore"})," source"]}),"."]}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsxs)(t.p,{children:["Note that this method is not available on the ",(0,i.jsx)(t.code,{children:"IAnalyticsStore"})," interface, but only on the ",(0,i.jsx)(t.code,{children:"MemoryAnalyticsStore"})," type."]}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"// create the store\nconst store = new MemoryAnalyticsStore();\n\n// initialize it\nawait store.init();\n"})})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},7474:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>o});var s=n(2155);const i={},r=s.createContext(i);function a(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);