"use strict";(self.webpackChunk_powerhousedao_academy=self.webpackChunk_powerhousedao_academy||[]).push([[2430],{7402:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"academy/MasteryTrack/WorkWithData/Analytics Engine/typescript/pg","title":"Postgres store","description":"The PostgresAnalyticsStore is an IAnalyticsStore implementation that leverages a Postgres database. It requires some APIs that do not run in a browser, and is intended for server-side applications.","source":"@site/docs/academy/02-MasteryTrack/04-WorkWithData/06-Analytics Engine/typescript/pg.md","sourceDirName":"academy/02-MasteryTrack/04-WorkWithData/06-Analytics Engine/typescript","slug":"/academy/MasteryTrack/WorkWithData/Analytics Engine/typescript/pg","permalink":"/academy/MasteryTrack/WorkWithData/Analytics Engine/typescript/pg","draft":false,"unlisted":false,"editUrl":"https://github.com/powerhouse-inc/powerhouse-docs/tree/dev/docs/academy/02-MasteryTrack/04-WorkWithData/06-Analytics Engine/typescript/pg.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"academySidebar","previous":{"title":"Browser store","permalink":"/academy/MasteryTrack/WorkWithData/Analytics Engine/typescript/browser"},"next":{"title":"Utilities","permalink":"/academy/MasteryTrack/WorkWithData/Analytics Engine/typescript/utilities"}}');var r=n(5723),i=n(7474);const o={sidebar_position:3},a="Postgres store",c={},l=[{value:"Construction",id:"construction",level:2},{value:"Raw queries",id:"raw-queries",level:2}];function d(e){const t={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"postgres-store",children:"Postgres store"})}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"PostgresAnalyticsStore"})," is an ",(0,r.jsx)(t.code,{children:"IAnalyticsStore"})," implementation that leverages a Postgres database. It requires some APIs that do not run in a browser, and is intended for server-side applications."]}),"\n",(0,r.jsx)("aside",{class:"notice",children:(0,r.jsxs)(t.p,{children:["See the ",(0,r.jsx)("a",{href:"#compatibility",children:"Compatibility"})," section for details on which stores are intended to be used in different execution environments."]})}),"\n",(0,r.jsx)(t.h2,{id:"construction",children:"Construction"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"PostgresAnalyticsStore"})," uses the ",(0,r.jsx)(t.a,{href:"https://www.npmjs.com/package/pg",children:(0,r.jsx)(t.code,{children:"pg"})})," package and requires Postgres connection information."]}),"\n",(0,r.jsxs)(t.p,{children:["By providing a PG connection string, the store will automatically create a ",(0,r.jsx)(t.code,{children:"pg"})," instance, internally."]}),"\n",(0,r.jsxs)(t.p,{children:["A docker-compose file is provided ",(0,r.jsx)(t.a,{href:"https://github.com/powerhouse-inc/analytics-engine/blob/main/pg/docker-compose.test.yml",children:"here"})," that will spin up an instance quickly. Note that it cannot be copy/pasted but must be run in the checked out repository to access the correct initialization scripts. See the ",(0,r.jsx)(t.a,{href:"https://github.com/powerhouse-inc/analytics-engine/tree/main?tab=readme-ov-file#pg",children:"developer documentation"})," for more information."]}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:"Create with only a connection string."}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",children:'// connects to a local postgres instance, configured by the provided docker-compose file\nconst store = new PostgresAnalyticsStore({\n  connectionString: "postgresql://postgres:password@localhost:5555/analytics",\n});\n'})}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsxs)(t.p,{children:["Instead, create with a ",(0,r.jsx)(t.code,{children:"knex"})," object."]}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",children:'import knexFactory from "knex";\n\nconst knex = knexFactory({\n  client: "pg",\n  connection: "...",\n});\n\nconst store = new PostgresAnalyticsStore({\n  knex,\n});\n'})}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"PostgresAnalyticsStore"})," may also be created with optional contructor arguments that may be helpful for debugging or metrics collection."]}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",children:'const store = new PostgresAnalyticsStore({\n  queryLogger: querydefaultQueryLogger("memory"),\n  resultsLogger: defaultResultsLogger("memory"),\n  profiler: new PassthroughAnalyticsProfiler(),\n});\n'})}),"\n",(0,r.jsxs)(t.p,{children:["For more details on these optional constructor parameters, see the ",(0,r.jsx)(t.a,{href:"#utilities",children:"Utilities"})," section."]}),"\n",(0,r.jsx)(t.h2,{id:"raw-queries",children:"Raw queries"}),"\n",(0,r.jsxs)(t.p,{children:["Though there is no method on ",(0,r.jsx)(t.code,{children:"IAnalyticsStore"})," for running arbitrary queries, the ",(0,r.jsx)(t.code,{children:"PostgresAnalyticsStore"})," implementation provides a ",(0,r.jsx)(t.code,{children:"raw(sql: string)"})," method. This is used only in development, testing, and ",(0,r.jsx)(t.a,{href:"https://github.com/powerhouse-inc/analytics-engine/blob/main/benchmarks/src/wasm.ts",children:"benchmarking"})," situations and is not intended for production use cases."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",children:'const results = store.raw(`select distinct unit from "AnalyticsSeries"`);\n'})})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},7474:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var s=n(2155);const r={},i=s.createContext(r);function o(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);