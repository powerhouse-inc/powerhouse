"use strict";(self.webpackChunk_powerhousedao_academy=self.webpackChunk_powerhousedao_academy||[]).push([[6038],{3507:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"academy/ExampleUsecases/Chatroom/ImplementChatroomEditor","title":"Implement Chatroom Editor","description":"In this section you will implement the Chatroom document model editor. This means you will create a simple user interface for the Chatroom document model which will be used inside the Connect app to visualise our chatroom, send messages and emoji reactions.","source":"@site/docs/academy/03-ExampleUsecases/Chatroom/05-ImplementChatroomEditor.md","sourceDirName":"academy/03-ExampleUsecases/Chatroom","slug":"/academy/ExampleUsecases/Chatroom/ImplementChatroomEditor","permalink":"/academy/ExampleUsecases/Chatroom/ImplementChatroomEditor","draft":false,"unlisted":false,"editUrl":"https://github.com/powerhouse-inc/powerhouse-docs/tree/dev/docs/academy/03-ExampleUsecases/Chatroom/05-ImplementChatroomEditor.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"academySidebar","previous":{"title":"Implement Operation Reducers","permalink":"/academy/ExampleUsecases/Chatroom/ImplementOperationReducers"},"next":{"title":"Launch a local Reactor","permalink":"/academy/ExampleUsecases/Chatroom/LaunchALocalReactor"}}');var s=o(5723),a=o(7474);const r={},i="Implement Chatroom Editor",c={},d=[{value:"Generate the editor template",id:"generate-the-editor-template",level:2},{value:"Add the necessary components for your editor first",id:"add-the-necessary-components-for-your-editor-first",level:2}];function m(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"implement-chatroom-editor",children:"Implement Chatroom Editor"})}),"\n",(0,s.jsxs)(n.p,{children:["In this section you will implement the ",(0,s.jsx)(n.code,{children:"Chatroom"})," document model editor. This means you will create a simple user interface for the ",(0,s.jsx)(n.code,{children:"Chatroom"})," document model which will be used inside the Connect app to visualise our chatroom, send messages and emoji reactions."]}),"\n",(0,s.jsx)(n.h2,{id:"generate-the-editor-template",children:"Generate the editor template"}),"\n",(0,s.jsxs)(n.p,{children:["Run below command to generate the editor template for the ",(0,s.jsx)(n.code,{children:"Chatroom"})," document model. This command reads the ",(0,s.jsx)(n.code,{children:"Chatroom"})," document model definition from the ",(0,s.jsx)(n.code,{children:"document-models"})," folder and generates the editor template in the ",(0,s.jsx)(n.code,{children:"editors/chat-room/editor.tsx"})," folder."]}),"\n",(0,s.jsxs)(n.p,{children:["Notice the ",(0,s.jsx)(n.code,{children:"--editor"})," flag which defines the ",(0,s.jsx)(n.code,{children:"chatroom"})," document model editor. And the ",(0,s.jsx)(n.code,{children:"--document-types"})," flag which defines the document type ",(0,s.jsx)(n.code,{children:"powerhouse/chatroom"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ph generate --editor ChatRoomEditor --document-types powerhouse/chat-room\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Once complete, navigate to the ",(0,s.jsx)(n.code,{children:"editors/chat-room/editor.tsx"})," file and open it in your editor."]}),"\n",(0,s.jsx)(n.p,{children:"As you'll see you will need to add more complex logic to make the chatroom functional and interact with our document model."}),"\n",(0,s.jsx)(n.h2,{id:"add-the-necessary-components-for-your-editor-first",children:"Add the necessary components for your editor first"}),"\n",(0,s.jsxs)(n.p,{children:["Download the repository of the chatroom-demo as a zip file ",(0,s.jsx)(n.a,{href:"https://github.com/powerhouse-inc/chatroom-demo",children:"https://github.com/powerhouse-inc/chatroom-demo"}),"\nand navigate to .../chatroom-demo-main/editors/chat-room-editor to copy both the components folder & utils function. In this repository you will also find all of the other code snippets we've been using in this tutorial."]}),"\n",(0,s.jsx)(n.p,{children:"Drag the folder with react components & utils functions into your VSCode of your chat-room-editor."}),"\n",(0,s.jsx)(n.p,{children:"In this folder you'll find:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"An avatar to be set for each chat room participant"}),"\n",(0,s.jsx)(n.li,{children:"The chatroom environment itself"}),"\n",(0,s.jsx)(n.li,{children:"A header for the chatroom"}),"\n",(0,s.jsx)(n.li,{children:"The UI for rendering the message, username and reaction popup."}),"\n",(0,s.jsx)(n.li,{children:"The emoji reaction interface"}),"\n",(0,s.jsx)(n.li,{children:"A UI for a text input field"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The utils function will help you with mapping information from the document model to your chatroom components. Such as your emoji values to the relevant emoji to be displayed."}),"\n",(0,s.jsxs)(n.p,{children:["Now, let's copy & paste the code below into the ",(0,s.jsx)(n.code,{children:"editor.tsx"})," file located at ",(0,s.jsx)(n.code,{children:"editors/chat-room-editor"}),"and save the file."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import { generateId } from "document-model/core";\nimport { useUser } from "@powerhousedao/reactor-browser/connect";\nimport { useSelectedChatRoomDocument } from "../../document-models/chat-room/hooks.js";\nimport {\n  addMessage,\n  addEmojiReaction,\n  removeEmojiReaction,\n  editChatName,\n  editChatDescription,\n} from "../../document-models/chat-room/gen/creators.js";\nimport {\n  ChatRoom,\n  type ChatRoomProps,\n  type MessageProps,\n} from "./components/index.js";\nimport { reactionKeyToReactionType, mapReactions } from "./utils.js";\n\nexport default function Editor() {\n  const [document, dispatch] = useSelectedChatRoomDocument();\n  const user = useUser();\n\n  const disableChatRoom = !user;\n\n  if (!document) {\n    return <div>Loading...</div>;\n  }\n\n  const messages: ChatRoomProps["messages"] =\n    document.state.global.messages.map((message) => ({\n      id: message.id,\n      message: message.content || "",\n      timestamp: message.sentAt,\n      userName: message.sender.name || message.sender.id,\n      imgUrl: message.sender.avatarUrl || undefined,\n      isCurrentUser: message.sender.id === user?.address,\n      reactions: mapReactions(message.reactions),\n    }));\n\n  const onSendMessage: ChatRoomProps["onSendMessage"] = (message) => {\n    if (!message) {\n      return;\n    }\n\n    dispatch(\n      addMessage({\n        messageId: generateId(),\n        content: message,\n        sender: {\n          id: user?.address || "anon-user",\n          name: user?.ens?.name || null,\n          avatarUrl: user?.ens?.avatarUrl || null,\n        },\n        sentAt: new Date().toISOString(),\n      }),\n    );\n  };\n\n  const addReaction = (\n    messageId: string,\n    userId: string,\n    reactionType: "HEART" | "THUMBS_UP" | "THUMBS_DOWN" | "LAUGH" | "CRY",\n  ) => {\n    dispatch(\n      addEmojiReaction({\n        messageId,\n        reactedBy: userId,\n        type: reactionType,\n      }),\n    );\n  };\n\n  const removeReaction = (\n    messageId: string,\n    userId: string,\n    reactionType: "HEART" | "THUMBS_UP" | "THUMBS_DOWN" | "LAUGH" | "CRY",\n  ) => {\n    dispatch(\n      removeEmojiReaction({\n        messageId,\n        senderId: userId,\n        type: reactionType,\n      }),\n    );\n  };\n\n  const onClickReaction: MessageProps["onClickReaction"] = (reaction) => {\n    const message = messages.find(\n      (message) => message.id === reaction.messageId,\n    );\n\n    if (!message) {\n      return;\n    }\n\n    const messageId = reaction.messageId;\n    const reactionType = reactionKeyToReactionType(reaction.type);\n    const currentUserId = user?.address || "anon-user";\n\n    const existingReaction = message.reactions?.find(\n      (r) => r.type === reaction.type,\n    );\n\n    if (existingReaction) {\n      const dispatchAction = existingReaction.reactedBy.includes(currentUserId)\n        ? removeReaction\n        : addReaction;\n\n      dispatchAction(messageId, currentUserId, reactionType);\n    } else {\n      addReaction(messageId, currentUserId, reactionType);\n    }\n  };\n\n  const onSubmitTitle: ChatRoomProps["onSubmitTitle"] = (title) => {\n    dispatch(editChatName({ name: title }));\n  };\n\n  const onSubmitDescription: ChatRoomProps["onSubmitDescription"] = (\n    description,\n  ) => {\n    dispatch(editChatDescription({ description }));\n  };\n\n  return (\n    <div\n      style={{\n        height: "calc(100vh - 140px)",\n      }}\n    >\n      <ChatRoom\n        description={\n          document.state.global.description || "This is a chat room demo"\n        }\n        disabled={disableChatRoom}\n        messages={messages}\n        onClickReaction={onClickReaction}\n        onSendMessage={onSendMessage}\n        onSubmitDescription={onSubmitDescription}\n        onSubmitTitle={onSubmitTitle}\n        title={document.state.global.name || "Chat Room Demo"}\n      />\n    </div>\n  );\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Now you can run the Connect app and see the ",(0,s.jsx)(n.code,{children:"Chatroom"})," editor in action."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ph connect\n"})}),"\n",(0,s.jsxs)(n.p,{children:["In connect, in the bottom right corner you'll find a new Document Model that you can create: ",(0,s.jsx)(n.code,{children:"ChatRoom"}),". Click on it to create a new Chat Room document. A warning will prompt you to login before you are able to send messages."]}),"\n",(0,s.jsx)(n.p,{children:"Login with an ethereum address via Renown to start sending messages."}),"\n",(0,s.jsxs)(n.p,{children:["Below GIF shows the ",(0,s.jsx)(n.code,{children:"Chatroom"})," editor in action."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Chatroom Editor",src:o(8633).A+"",width:"1905",height:"1197"})}),"\n",(0,s.jsxs)(n.p,{children:["If you managed to follow this tutorial until this point, you have successfully implemented the ",(0,s.jsx)(n.code,{children:"ChatRoom"})," document model with its reducer operations and editor."]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(m,{...e})}):m(e)}},7474:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>i});var t=o(2155);const s={},a=t.createContext(s);function r(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(a.Provider,{value:n},e.children)}},8633:(e,n,o)=>{o.d(n,{A:()=>t});const t=o.p+"assets/images/ChatRoomTest-1cb23d9a85c939b0f0a227a48de47b64.gif"}}]);