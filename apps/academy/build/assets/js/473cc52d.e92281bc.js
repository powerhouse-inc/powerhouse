"use strict";(self.webpackChunk_powerhousedao_academy=self.webpackChunk_powerhousedao_academy||[]).push([[6636],{288:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/vscode-e21705ff47c67dae20fddd901518518c.png"},7474:(e,t,o)=>{o.d(t,{R:()=>d,x:()=>r});var n=o(2155);const s={},i=n.createContext(s);function d(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),n.createElement(i.Provider,{value:t},e.children)}},8161:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>p,frontMatter:()=>d,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"academy/GetStarted/ImplementOperationReducers","title":"Implement the document model","description":"\ud83d\udce6 Reference Code:","source":"@site/docs/academy/01-GetStarted/03-ImplementOperationReducers.md","sourceDirName":"academy/01-GetStarted","slug":"/academy/GetStarted/ImplementOperationReducers","permalink":"/academy/GetStarted/ImplementOperationReducers","draft":false,"unlisted":false,"editUrl":"https://github.com/powerhouse-inc/powerhouse-docs/tree/dev/docs/academy/01-GetStarted/03-ImplementOperationReducers.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{},"sidebar":"academySidebar","previous":{"title":"Write the document specification","permalink":"/academy/GetStarted/DefineToDoListDocumentModel"},"next":{"title":"Build a to-do list editor","permalink":"/academy/GetStarted/BuildToDoListEditor"}}');var s=o(5723),i=o(7474);const d={},r="Implement the document model",c={},a=[{value:"Compare your reducer implementation",id:"compare-your-reducer-implementation",level:3},{value:"Compare your tests",id:"compare-your-tests",level:3},{value:"Visual comparison with GitHub Desktop",id:"visual-comparison-with-github-desktop",level:3},{value:"If you get stuck",id:"if-you-get-stuck",level:3},{value:"Understanding reducers in document models",id:"understanding-reducers-in-document-models",level:2},{value:"In your project directory",id:"in-your-project-directory",level:2},{value:"Write the operation reducers",id:"write-the-operation-reducers",level:2},{value:"Write the operation reducers tests",id:"write-the-operation-reducers-tests",level:2},{value:"Compare with reference branches",id:"compare-with-reference-branches",level:2},{value:"Up next: To-do list editor",id:"up-next-to-do-list-editor",level:2}];function l(e){const t={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components},{Details:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"implement-the-document-model",children:"Implement the document model"})}),"\n",(0,s.jsxs)(t.admonition,{title:"Tutorial Repository",type:"tip",children:[(0,s.jsxs)(t.p,{children:["\ud83d\udce6 ",(0,s.jsx)(t.strong,{children:"Reference Code"}),":"]}),(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Reducer Implementation"}),": ",(0,s.jsx)(t.a,{href:"https://github.com/powerhouse-inc/todo-tutorial/tree/step-3-implement-reducer-operation-handlers",children:"step-3-implement-reducer-operation-handlers"})]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Tests Implementation"}),": ",(0,s.jsx)(t.a,{href:"https://github.com/powerhouse-inc/todo-tutorial/tree/step-4-implement-tests-for-todos-operations",children:"step-4-implement-tests-for-todos-operations"})]}),"\n"]}),(0,s.jsx)(t.p,{children:"This tutorial covers two steps:"}),(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Step 3"}),": Implementing the reducer logic for add, update, and delete operations"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Step 4"}),": Writing comprehensive tests for the reducers"]}),"\n"]}),(0,s.jsxs)(t.p,{children:["You can view the exact code changes between steps using ",(0,s.jsx)(t.code,{children:"git diff step-3-implement-reducer-operation-handlers step-4-implement-tests-for-todos-operations"})]})]}),"\n",(0,s.jsxs)(n,{children:[(0,s.jsx)("summary",{children:"\ud83d\udcd6 How to use this tutorial"}),(0,s.jsxs)(t.p,{children:["This tutorial covers ",(0,s.jsx)(t.strong,{children:"two steps"}),": implementing reducers (step-3) and tests (step-4)."]}),(0,s.jsx)(t.h3,{id:"compare-your-reducer-implementation",children:"Compare your reducer implementation"}),(0,s.jsx)(t.p,{children:"After implementing your reducers:"}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"# Compare your reducers with step-3\ngit diff tutorial/step-3-implement-reducer-operation-handlers -- document-models/todo-list/src/reducers/\n\n# View the reference reducer implementation\ngit show tutorial/step-3-implement-reducer-operation-handlers:document-models/todo-list/src/reducers/todos.ts\n"})}),(0,s.jsx)(t.h3,{id:"compare-your-tests",children:"Compare your tests"}),(0,s.jsx)(t.p,{children:"After writing tests:"}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"# Compare your tests with step-4\ngit diff tutorial/step-4-implement-tests-for-todos-operations -- document-models/todo-list/src/tests/\n\n# See what changed from step-3 to step-4\ngit diff tutorial/step-3-implement-reducer-operation-handlers..tutorial/step-4-implement-tests-for-todos-operations\n"})}),(0,s.jsx)(t.h3,{id:"visual-comparison-with-github-desktop",children:"Visual comparison with GitHub Desktop"}),(0,s.jsx)(t.p,{children:"After committing your work, compare visually:"}),(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Branch"})," menu \u2192 ",(0,s.jsx)(t.strong,{children:'"Compare to Branch..."'})]}),"\n",(0,s.jsxs)(t.li,{children:["Select ",(0,s.jsx)(t.code,{children:"tutorial/step-3-implement-reducer-operation-handlers"})," or ",(0,s.jsx)(t.code,{children:"tutorial/step-4-implement-tests-for-todos-operations"})]}),"\n",(0,s.jsx)(t.li,{children:"Review differences in the visual interface"}),"\n"]}),(0,s.jsx)(t.p,{children:"See step 1 for detailed GitHub Desktop instructions."}),(0,s.jsx)(t.h3,{id:"if-you-get-stuck",children:"If you get stuck"}),(0,s.jsx)(t.p,{children:"View or reset to a specific step:"}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"# View the reducer code from step-3\ngit show tutorial/step-3-implement-reducer-operation-handlers:document-models/todo-list/src/reducers/todos.ts\n\n# Reset to step-3 (WARNING: loses your changes)\ngit reset --hard tutorial/step-3-implement-reducer-operation-handlers\n"})})]}),"\n",(0,s.jsxs)(t.p,{children:["In this section, we will implement and test the operation reducers for the ",(0,s.jsx)(t.strong,{children:"To-do List"})," document model. For this, you have to export the document model specification from the Connect application and import it into your Powerhouse project directory."]}),"\n",(0,s.jsxs)(t.p,{children:["To export the document model specification, follow the steps in the ",(0,s.jsx)(t.a,{href:"/academy/GetStarted/DefineToDoListDocumentModel",children:"Define ToDoList Document Model"})," section."]}),"\n",(0,s.jsx)(t.h2,{id:"understanding-reducers-in-document-models",children:"Understanding reducers in document models"}),"\n",(0,s.jsx)(t.p,{children:"Reducers are a core concept in Powerhouse document models. They implement the state transition logic for each operation defined in your schema."}),"\n",(0,s.jsx)(t.admonition,{type:"info",children:(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Connection to schema definition language (SDL)"}),": The reducers directly implement the operations you defined in your SDL. Remember how we defined ",(0,s.jsx)(t.code,{children:"AddTodoItemInput"}),", ",(0,s.jsx)(t.code,{children:"UpdateTodoItemInput"}),", and ",(0,s.jsx)(t.code,{children:"DeleteTodoItemInput"})," in our schema?",(0,s.jsx)(t.br,{}),"\n","The reducers provide the actual implementation of what happens when those operations are performed."]})}),"\n",(0,s.jsx)(t.p,{children:"To import the document model specification into your Powerhouse project, you can either:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Copy and paste the file directly into the root of your Powerhouse project."}),"\n",(0,s.jsx)(t.li,{children:"Or drag and drop the file into the Powerhouse project directory in the VSCode editor as seen in the image below:"}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Either step will import the document model specification into your Powerhouse project."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"vscode image",src:o(288).A+"",width:"1249",height:"889"})}),"\n",(0,s.jsx)(t.h2,{id:"in-your-project-directory",children:"In your project directory"}),"\n",(0,s.jsx)(t.p,{children:"The next steps will take place in the VSCode editor. Make sure to have it open and the terminal window inside VSCode open as well."}),"\n",(0,s.jsxs)(t.p,{children:["To write the operation reducers of the ",(0,s.jsx)(t.strong,{children:"To-do List"})," document model, you need to generate the document model code from the document model specification file you have exported into the Powerhouse project directory."]}),"\n",(0,s.jsx)(t.p,{children:"To do this, run the following command in the terminal:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"ph generate TodoList.phd\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Now you can navigate to ",(0,s.jsx)(t.code,{children:"/document-models/todo-list/src/reducers/todos.ts"})," and start writing the operation reducers."]}),"\n",(0,s.jsxs)(t.p,{children:["Open the ",(0,s.jsx)(t.code,{children:"todos.ts"})," file and you should see the scaffolding code that needs to be filled for the three operations you have specified earlier. The generated file will look like this:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-typescript",children:'import type { TodoListTodosOperations } from "todo-tutorial/document-models/todo-list";\n\nexport const todoListTodosOperations: TodoListTodosOperations = {\n  addTodoItemOperation(state, action) {\n    // TODO: Implement "addTodoItemOperation" reducer\n    throw new Error(\'Reducer "addTodoItemOperation" not yet implemented\');\n  },\n  updateTodoItemOperation(state, action) {\n    // TODO: Implement "updateTodoItemOperation" reducer\n    throw new Error(\'Reducer "updateTodoItemOperation" not yet implemented\');\n  },\n  deleteTodoItemOperation(state, action) {\n    // TODO: Implement "deleteTodoItemOperation" reducer\n    throw new Error(\'Reducer "deleteTodoItemOperation" not yet implemented\');\n  },\n};\n'})}),"\n",(0,s.jsx)(t.h2,{id:"write-the-operation-reducers",children:"Write the operation reducers"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Copy and paste the code below into the ",(0,s.jsx)(t.code,{children:"todos.ts"})," file in the ",(0,s.jsx)(t.code,{children:"reducers"})," folder."]}),"\n",(0,s.jsx)(t.li,{children:"Save the file."}),"\n"]}),"\n",(0,s.jsxs)(n,{children:[(0,s.jsx)("summary",{children:"Operation Reducers"}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-typescript",children:'import { generateId } from "document-model/core";\nimport type { TodoListTodosOperations } from "todo-tutorial/document-models/todo-list";\n\n// Export the operations object that implements all three todo operations\nexport const todoListTodosOperations: TodoListTodosOperations = {\n  addTodoItemOperation(state, action) {\n    // Generate a unique ID for the new todo item\n    // Using generateId() from document-model/core ensures uniqueness\n    const id = generateId();\n    \n    // Add the new item to the state\n    // Powerhouse uses Immer.js, so this "mutation" is actually immutable\n    state.items.push({ ...action.input, id, checked: false });\n  },\n  \n  updateTodoItemOperation(state, action) {\n    // Find the item to update by its ID\n    const item = state.items.find((item) => item.id === action.input.id);\n    \n    // Return early if item not found (you could also throw an error)\n    if (!item) return;\n    \n    // Update only the fields that are provided (partial update)\n    // Using nullish coalescing (??) to keep existing values if undefined\n    item.text = action.input.text ?? item.text;\n    item.checked = action.input.checked ?? item.checked;\n  },\n  \n  deleteTodoItemOperation(state, action) {\n    // Filter out the item with the matching ID\n    // This creates a new array without the deleted item\n    state.items = state.items.filter((item) => item.id !== action.input.id);\n  },\n};\n\n'})})]}),"\n",(0,s.jsx)(t.h2,{id:"write-the-operation-reducers-tests",children:"Write the operation reducers tests"}),"\n",(0,s.jsx)(t.p,{children:"In order to make sure the operation reducers are working as expected, you need to write tests for them."}),"\n",(0,s.jsxs)(t.p,{children:["Navigate to ",(0,s.jsx)(t.code,{children:"/document-models/todo-list/src/tests/todos.test.ts"})," and replace the scaffolding code with comprehensive tests."]}),"\n",(0,s.jsx)(t.p,{children:"Here are the tests for the three operations implemented in the reducers file. The test file:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Uses Vitest for testing"}),"\n",(0,s.jsxs)(t.li,{children:["Generates mock data using ",(0,s.jsx)(t.code,{children:"@powerhousedao/codegen"})]}),"\n",(0,s.jsx)(t.li,{children:"Creates an empty TodoList document model"}),"\n",(0,s.jsx)(t.li,{children:"Tests add, update, and delete operations"}),"\n",(0,s.jsx)(t.li,{children:"Verifies both the operation history and the resulting state"}),"\n"]}),"\n",(0,s.jsxs)(n,{children:[(0,s.jsx)("summary",{children:"Operation Reducers Tests"}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-typescript",children:'import { describe, it, expect } from "vitest";\nimport { generateMock } from "@powerhousedao/codegen";\nimport type {\n  AddTodoItemInput,\n  DeleteTodoItemInput,\n  UpdateTodoItemInput,\n} from "todo-tutorial/document-models/todo-list";\nimport {\n  reducer,\n  utils,\n  isTodoListDocument,\n  addTodoItem,\n  AddTodoItemInputSchema,\n  updateTodoItem,\n  UpdateTodoItemInputSchema,\n  deleteTodoItem,\n  DeleteTodoItemInputSchema,\n  TodoItemSchema,\n} from "todo-tutorial/document-models/todo-list";\n\ndescribe("Todos Operations", () => {\n  // Test adding a new todo item\n  it("should handle addTodoItem operation", () => {\n    const document = utils.createDocument();\n    const input: AddTodoItemInput = generateMock(AddTodoItemInputSchema());\n\n    const updatedDocument = reducer(document, addTodoItem(input));\n    expect(isTodoListDocument(updatedDocument)).toBe(true);\n\n    // Verify the operation was recorded\n    expect(updatedDocument.operations.global).toHaveLength(1);\n    expect(updatedDocument.operations.global[0].action.type).toBe("ADD_TODO_ITEM");\n    expect(updatedDocument.operations.global[0].action.input).toStrictEqual(input);\n    expect(updatedDocument.operations.global[0].index).toEqual(0);\n  });\n\n  // Test updating a todo item\'s text\n  it("should handle updateTodoItem operation to update text", () => {\n    const mockItem = generateMock(TodoItemSchema());\n    const input: UpdateTodoItemInput = generateMock(UpdateTodoItemInputSchema());\n    input.id = mockItem.id;\n    const newText = "new text";\n    input.text = newText;\n    input.checked = undefined;\n    \n    const document = utils.createDocument({\n      global: {\n        items: [mockItem],\n      },\n    });\n\n    const updatedDocument = reducer(document, updateTodoItem(input));\n    expect(isTodoListDocument(updatedDocument)).toBe(true);\n\n    // Verify the operation was recorded\n    expect(updatedDocument.operations.global).toHaveLength(1);\n    expect(updatedDocument.operations.global[0].action.type).toBe("UPDATE_TODO_ITEM");\n    \n    // Verify the state was updated correctly\n    const updatedItem = updatedDocument.state.global.items.find(\n      (item) => item.id === input.id,\n    );\n    expect(updatedItem?.text).toBe(newText);\n    expect(updatedItem?.checked).toBe(mockItem.checked);\n  });\n\n  // Test updating a todo item\'s checked status\n  it("should handle updateTodoItem operation to update checked", () => {\n    const mockItem = generateMock(TodoItemSchema());\n    const input: UpdateTodoItemInput = generateMock(UpdateTodoItemInputSchema());\n    input.id = mockItem.id;\n    const newChecked = !mockItem.checked;\n    input.checked = newChecked;\n    input.text = undefined;\n    \n    const document = utils.createDocument({\n      global: {\n        items: [mockItem],\n      },\n    });\n\n    const updatedDocument = reducer(document, updateTodoItem(input));\n    expect(isTodoListDocument(updatedDocument)).toBe(true);\n\n    const updatedItem = updatedDocument.state.global.items.find(\n      (item) => item.id === input.id,\n    );\n    expect(updatedItem?.text).toBe(mockItem.text);\n    expect(updatedItem?.checked).toBe(newChecked);\n  });\n\n  // Test deleting a todo item\n  it("should handle deleteTodoItem operation", () => {\n    const mockItem = generateMock(TodoItemSchema());\n    const document = utils.createDocument({\n      global: {\n        items: [mockItem],\n      },\n    });\n    \n    const input: DeleteTodoItemInput = generateMock(DeleteTodoItemInputSchema());\n    input.id = mockItem.id;\n    \n    const updatedDocument = reducer(document, deleteTodoItem(input));\n    expect(isTodoListDocument(updatedDocument)).toBe(true);\n\n    // Verify the operation was recorded\n    expect(updatedDocument.operations.global).toHaveLength(1);\n    expect(updatedDocument.operations.global[0].action.type).toBe("DELETE_TODO_ITEM");\n    \n    // Verify the item was removed from state\n    const updatedItems = updatedDocument.state.global.items;\n    expect(updatedItems).toHaveLength(0);\n  });\n});\n'})})]}),"\n",(0,s.jsx)(t.p,{children:"Now you can run the tests to make sure the operation reducers are working as expected."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"pnpm run test\n"})}),"\n",(0,s.jsx)(t.p,{children:"Output should be as follows:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:" \u2713 document-models/todo-list/src/tests/document-model.test.ts (3 tests) 1ms\n \u2713 document-models/todo-list/src/tests/todos.test.ts (4 tests) 8ms\n\n Test Files  2 passed (2)\n      Tests  7 passed (7)\n   Start at  19:37:33\n   Duration  1.84s (transform 75ms, setup 0ms, collect 2.03s, tests 9ms, environment 0ms, prepare 92ms)\n"})}),"\n",(0,s.jsxs)(t.p,{children:["If you got the same output, you have successfully implemented the operation reducers and tests for the ",(0,s.jsx)(t.strong,{children:"To-do List"})," document model. Congratulations, you've successfully set up the backbone for a simple ",(0,s.jsx)(t.strong,{children:"To-do List"})," document."]}),"\n",(0,s.jsx)(t.h2,{id:"compare-with-reference-branches",children:"Compare with reference branches"}),"\n",(0,s.jsx)(t.p,{children:"Verify your implementation matches the tutorial steps:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"# View step-3 reducer implementation\ngit show tutorial/step-3-implement-reducer-operation-handlers:document-models/todo-list/src/reducers/todos.ts\n\n# View step-4 test implementation\ngit show tutorial/step-4-implement-tests-for-todos-operations:document-models/todo-list/src/tests/todos.test.ts\n\n# See what changed between step-3 and step-4\ngit diff tutorial/step-3-implement-reducer-operation-handlers..tutorial/step-4-implement-tests-for-todos-operations\n"})}),"\n",(0,s.jsx)(t.h2,{id:"up-next-to-do-list-editor",children:"Up next: To-do list editor"}),"\n",(0,s.jsxs)(t.p,{children:["In the next chapter of this introduction track you will learn how to implement an editor for your document model so you can see a simple user interface for the ",(0,s.jsx)(t.strong,{children:"To-do List"})," document model in action."]})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}}}]);